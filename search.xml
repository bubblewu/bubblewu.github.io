<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>String类的intern()方法</title>
      <link href="/ckbesij6t000029s67j9p5x9z/"/>
      <url>/ckbesij6t000029s67j9p5x9z/</url>
      
        <content type="html"><![CDATA[<h1 id="String-intern-方法"><a href="#String-intern-方法" class="headerlink" title="String::intern()方法"></a>String::intern()方法</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><code>String::intern()</code>是一个Native方法，用于返回该对象在常量池中的引用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">intern</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>作用：如果字符串常量池中已经包含一个等于该String对象的字符串，则返回代表池中这个字符串的String对象的引用；否则，会将此String对象包含的字符串添加到常量池中，并且返回此String对象的引用。</p><a id="more"></a><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><ul><li>示例1：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 在JDK 6中运行，会得到三个false；</span></span><br><span class="line"><span class="comment"> * 在JDK 6中，intern()方法会把首次遇到的字符串实例复制到永久代（方法区）的字符串常量池中存储，</span></span><br><span class="line"><span class="comment"> * 返回的也是永久代里面这个字符串实例的引用，而由StringBuilder创建的字符串对象实例在Java堆上，</span></span><br><span class="line"><span class="comment"> * 所以必然不可能是同一个引用，结果将返回false。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - 而在JDK 7后中运行，会得到一个true、一个false和一个true；</span></span><br><span class="line"><span class="comment"> * 因为JDK7中，intern()方法实现就不需要再拷贝字符串的实例到永久代了，既然字符串常量池已经移到Java堆中，</span></span><br><span class="line"><span class="comment"> * 那只需要在常量池里记录一下首次出现的实例引用即可。</span></span><br><span class="line"><span class="comment"> * 因此intern()返回的引用和由StringBuilder创建的那个字符串实例就是同一个。</span></span><br><span class="line"><span class="comment"> * 而对str2比较返回false，这是因为java这个字符串在执行StringBuilder()之前就已经出现过了，(在加载sun.misc.Version这个类的时候进入常量池的)</span></span><br><span class="line"><span class="comment"> * 字符串常量池中已经有它的引用，不符合intern()方法要求“首次遇到”的原则，“JVM调优”这个字符串则是首次出现的，因此结果返回true。</span></span><br><span class="line"><span class="comment"> * 而str3和str1一样，"JDKJVM"这个字符串则是首次出现。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String str1 = <span class="keyword">new</span> StringBuilder().append(<span class="string">"JVM"</span>).append(<span class="string">"调优"</span>).toString();</span><br><span class="line">    System.out.println(str1.intern() == str1);</span><br><span class="line">    <span class="comment">// java这个字符串在执行StringBuilder()之前就已经出现过了，在加载sun.misc.Version这个类的时候进入常量池的。</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 参考：https://www.zhihu.com/question/51102308/answer/124441115</span></span><br><span class="line"><span class="comment">     * sun.misc.Version类会在JDK类库的初始化过程中被加载并初始化，</span></span><br><span class="line"><span class="comment">     * 而在初始化时它需要对静态常量字段根据指定的常量值（ConstantValue）做默认初始化，</span></span><br><span class="line"><span class="comment">     * 此时被 sun.misc.Version.launcher 静态常量字段所引用的"java"字符串字面量就被intern到HotSpot VM的字符串常量池StringTable里了。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String str2 = <span class="keyword">new</span> StringBuilder().append(<span class="string">"ja"</span>).append(<span class="string">"va"</span>).toString();</span><br><span class="line">    System.out.println(str2.intern() == str2);</span><br><span class="line">    <span class="comment">// 而JDKJVM这个字符串则是首次出现</span></span><br><span class="line">    String str3 = <span class="keyword">new</span> StringBuilder().append(<span class="string">"JDK"</span>).append(<span class="string">"JVM"</span>).toString();</span><br><span class="line">    System.out.println(str3.intern() == str3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * java中的String是引用类型。创建的String对象，实际上存储的是一个地址。</span></span><br><span class="line"><span class="comment"> * 所以下面a和b都是引用类型，其存储的是字符串的地址。它们本身存储在Java虚拟机栈的局部变量表中。</span></span><br><span class="line"><span class="comment"> * - a：直接将字符串存储在常量池中，然后将a指向常量池种中的"JVM"。</span></span><br><span class="line"><span class="comment"> * - b：先将字符串"JVM"存储在常量池中，然后在heap中创建一个对象，该对象指向常量池中的"JVM"，最后将b指向heap中创建的这个对象。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 也就是说，a和b存储的内容是一样的，都是"JVM"，但地址不一样：a中保存的是常量池中"JVM"的地址，b保存的是heap中那个对象的地址，</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 双等于号"=="比较的是地址，equals()比较的是内容。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compareStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String a = <span class="string">"JVM"</span>;</span><br><span class="line">    <span class="comment">// new一个对象</span></span><br><span class="line">    String b = <span class="keyword">new</span> String(<span class="string">"JVM"</span>);</span><br><span class="line">    <span class="comment">// == 比较地址是否相等</span></span><br><span class="line">    <span class="comment">// 都在运行时常量池中</span></span><br><span class="line">    System.out.println(<span class="string">"JVM"</span> == a); <span class="comment">// true</span></span><br><span class="line">    System.out.println(a.intern() == a); <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// a为字符字面量（存储在运行时常量池中），b为对象（存储在堆中），所以不等。</span></span><br><span class="line">    System.out.println(a == b); <span class="comment">// false</span></span><br><span class="line">    System.out.println(a.intern() == b); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    System.out.println(a.equals(b));  <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>示例2：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         双等号"=="比较的是地址；equals()比较的是内容。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        String s1 = <span class="string">"abc"</span>;</span><br><span class="line">        String s2 = <span class="string">"abc"</span>;</span><br><span class="line">        System.out.println(s1 == s2); <span class="comment">// true</span></span><br><span class="line">        System.out.println(s1.equals(s2)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">        String s3 = <span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br><span class="line">        System.out.println(s1 == s3); <span class="comment">// false</span></span><br><span class="line">        System.out.println(s1.equals(s3)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(s1 == s3.intern()); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">        String s4 = <span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br><span class="line">        System.out.println(s3 == s4);  <span class="comment">// false</span></span><br><span class="line">        System.out.println(s3.intern() == s4.intern());  <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Neo4j的时光网电影数据可视化【附源码】</title>
      <link href="/ckbarwdyc0000z5yd8tl0cjqn/"/>
      <url>/ckbarwdyc0000z5yd8tl0cjqn/</url>
      
        <content type="html"><![CDATA[<h1 id="基于Neo4j的电影数据可视化"><a href="#基于Neo4j的电影数据可视化" class="headerlink" title="基于Neo4j的电影数据可视化"></a>基于Neo4j的电影数据可视化</h1><p>本文主要内容为：</p><ul><li>基于requests + BeautifulSoup抓取时光网电影数据；</li><li>基于电影数据构建电影和关系实体信息；</li><li>数据导入neo4j进行存储分析；</li><li>基于Bottle框架的对neo4j数据进行查询可视化展示。</li></ul><p>效果展示：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/neo4j/web-demo.png" alt="效果展示"></p><a id="more"></a><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="新建虚拟环境并安装所需包"><a href="#新建虚拟环境并安装所需包" class="headerlink" title="新建虚拟环境并安装所需包"></a>新建虚拟环境并安装所需包</h3><ul><li>新建虚拟环境：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看本机已经安装的python虚拟环境</span><br><span class="line">conda env list</span><br><span class="line"># 新建graph-37环境</span><br><span class="line">conda create -n graph-37 python&#x3D;3.7</span><br><span class="line"># 生效新建的虚拟环境</span><br><span class="line">conda activate graph-37</span><br><span class="line">## 退出</span><br><span class="line">#conda deactivate</span><br></pre></td></tr></table></figure></li><li>安装所需包：<br>根据requirements.txt文件来安装：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>requirements.txt文件：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">beautifulsoup4&#x3D;&#x3D;4.9.1</span><br><span class="line">bs4&#x3D;&#x3D;0.0.1</span><br><span class="line">certifi&#x3D;&#x3D;2020.4.5.1</span><br><span class="line">chardet&#x3D;&#x3D;3.0.4</span><br><span class="line">Click&#x3D;&#x3D;7.0</span><br><span class="line">colorama&#x3D;&#x3D;0.4.3</span><br><span class="line">et-xmlfile&#x3D;&#x3D;1.0.1</span><br><span class="line">idna&#x3D;&#x3D;2.9</span><br><span class="line">jdcal&#x3D;&#x3D;1.4.1</span><br><span class="line">lxml&#x3D;&#x3D;4.5.1</span><br><span class="line">neobolt&#x3D;&#x3D;1.7.17</span><br><span class="line">neotime&#x3D;&#x3D;1.7.4</span><br><span class="line">numpy&#x3D;&#x3D;1.18.5</span><br><span class="line">openpyxl&#x3D;&#x3D;3.0.3</span><br><span class="line">pandas&#x3D;&#x3D;1.0.4</span><br><span class="line">prompt-toolkit&#x3D;&#x3D;2.0.10</span><br><span class="line">py2neo&#x3D;&#x3D;4.3.0</span><br><span class="line">Pygments&#x3D;&#x3D;2.3.1</span><br><span class="line">python-dateutil&#x3D;&#x3D;2.8.1</span><br><span class="line">pytz&#x3D;&#x3D;2020.1</span><br><span class="line">requests&#x3D;&#x3D;2.23.0</span><br><span class="line">six&#x3D;&#x3D;1.15.0</span><br><span class="line">soupsieve&#x3D;&#x3D;2.0.1</span><br><span class="line">urllib3&#x3D;&#x3D;1.24.3</span><br><span class="line">wcwidth&#x3D;&#x3D;0.2.4</span><br></pre></td></tr></table></figure></li></ul><h2 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h2><p>本文数据来自<a href="http://www.mtime.com/top/movie/top100/" target="_blank" rel="external nofollow noopener noreferrer">时光网电影Top100</a>。<br>基于python对该源进行数据抓取，并将数据生成相应的实体和关系：<br>可参考：<a href="https://github.com/bubblewu/movie-neo4j/blob/master/mtime/mtime_main.py" target="_blank" rel="external nofollow noopener noreferrer">GitHub：时光网数据抓取处理</a></p><p>实体和关系如下：：</p><ul><li><p>电影：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index:ID,rank,src,name,movie_en,year,image,:LABEL</span><br><span class="line">10000,1,http:&#x2F;&#x2F;movie.mtime.com&#x2F;12231&#x2F;,肖申克的救赎,The Shawshank Redemption,1994,http:&#x2F;&#x2F;img31.mtime.cn&#x2F;mt&#x2F;2014&#x2F;03&#x2F;07&#x2F;123549.37376649_96X128.jpg,电影表</span><br><span class="line">10001,2,http:&#x2F;&#x2F;movie.mtime.com&#x2F;99547&#x2F;,盗梦空间,Inception,2010,http:&#x2F;&#x2F;img31.mtime.cn&#x2F;mt&#x2F;2014&#x2F;01&#x2F;06&#x2F;105446.89493583_96X128.jpg,电影表</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>演员：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index:ID,actor,:LABEL</span><br><span class="line">30000,杰伊·巴鲁切尔,演员表</span><br><span class="line">30001,维果·莫腾森,演员表</span><br><span class="line">30002,布拉德·皮特,演员表</span><br><span class="line">30003,李·科布,演员表</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>导演：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index:ID,director,:LABEL</span><br><span class="line">20000,彼得·索恩,导演表</span><br><span class="line">20001,克里斯托弗·诺兰,导演表</span><br><span class="line">20002,朴赞郁,导演表</span><br><span class="line">20003,赛尔乔·莱昂内,导演表</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><p>关系：</p><ul><li><p>电影与导演关系：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:START_ID,:END_ID,relation,:TYPE</span><br><span class="line">20069,10000,导演,导演</span><br><span class="line">20001,10001,导演,导演</span><br><span class="line">20010,10002,导演,导演</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>电影与主演关系：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:START_ID,:END_ID,relation,:TYPE</span><br><span class="line">30156,10000,主演,主演</span><br><span class="line">30026,10000,主演,主演</span><br><span class="line">30063,10001,主演,主演</span><br><span class="line">30031,10001,主演,主演</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>导演和演员关系：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:START_ID,:END_ID,relation,:TYPE</span><br><span class="line">20069,30156,相关,相关</span><br><span class="line">20069,30026,相关,相关</span><br><span class="line">20001,30063,相关,相关</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><h2 id="Neo4j存储"><a href="#Neo4j存储" class="headerlink" title="Neo4j存储"></a>Neo4j存储</h2><h3 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h3><p>必须停止neo4j；只能生成新的数据库，而不能在已存在的数据库中插入数据。</p><p>通过下面的命令导入定义好的实体和关系数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"># 脚本来执行将csv文件（节点和关系）导入neo4j</span><br><span class="line"># 注意：必须停止neo4j；只能生成新的数据库，而不能在已存在的数据库中插入数据。</span><br><span class="line"></span><br><span class="line">db_name&#x3D;MovieMTime.db</span><br><span class="line">neo4j_path&#x3D;&#x2F;Users&#x2F;wugang&#x2F;env&#x2F;neo4j-community-4.0.4</span><br><span class="line">base_path&#x3D;&#x2F;Users&#x2F;wugang&#x2F;code&#x2F;python&#x2F;moive-kg&#x2F;data&#x2F;mtime</span><br><span class="line"></span><br><span class="line">import() &#123;</span><br><span class="line">  cd $&#123;neo4j_path&#125;</span><br><span class="line">  .&#x2F;bin&#x2F;neo4j stop</span><br><span class="line">  rm -rf &#x2F;Users&#x2F;wugang&#x2F;env&#x2F;neo4j-community-4.0.4&#x2F;data&#x2F;databases&#x2F;$&#123;db_name&#125;</span><br><span class="line">  .&#x2F;bin&#x2F;neo4j-admin import --verbose \</span><br><span class="line">                        --database $&#123;db_name&#125; \</span><br><span class="line">                        --id-type STRING \</span><br><span class="line">                        --input-encoding&#x3D;UTF-8 \</span><br><span class="line">                        --ignore-extra-columns&#x3D;false \</span><br><span class="line">                        --trim-strings&#x3D;true \</span><br><span class="line">                        --delimiter&#x3D;, \</span><br><span class="line">                        --array-delimiter&#x3D;&#39;;&#39; \</span><br><span class="line">                        --processors&#x3D;4 \</span><br><span class="line">                        --nodes $&#123;base_path&#125;&#x2F;mtime_movie_entity.csv \</span><br><span class="line">                        --nodes $&#123;base_path&#125;&#x2F;mtime_actor_entity.csv \</span><br><span class="line">                        --nodes $&#123;base_path&#125;&#x2F;mtime_director_entity.csv \</span><br><span class="line">                        --relationships $&#123;base_path&#125;&#x2F;mtime_director_actor_relationship.csv \</span><br><span class="line">                        --relationships $&#123;base_path&#125;&#x2F;mtime_movie_actor_relationship.csv  \</span><br><span class="line">                        --relationships $&#123;base_path&#125;&#x2F;mtime_movie_director_relationship.csv</span><br><span class="line">  # 需要修改neo4j.conf配置文件中的默认db才能展示新建的db，否则还是默认的。（只能指定一个db）</span><br><span class="line">#  .&#x2F;bin&#x2F;neo4j start</span><br><span class="line">#  .&#x2F;bin&#x2F;neo4j stop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import</span><br></pre></td></tr></table></figure><h3 id="数据查看"><a href="#数据查看" class="headerlink" title="数据查看"></a>数据查看</h3><p>修改配置将默认db改为刚才新建的电影的db，否则还是默认的库。<br>vim conf/neo4j.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbms.active_database&#x3D;MovieMTime.db</span><br></pre></td></tr></table></figure><p>启动neo4j服务（neo4j版本为4.0.3）:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;neo4j start</span><br></pre></td></tr></table></figure><p>进入管理界面：<a href="http://127.0.0.1:7474/" target="_blank" rel="external nofollow noopener noreferrer">http://127.0.0.1:7474</a></p><p>查看实体数据：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/neo4j/neo4j-moviemtime-movie.png" alt="实体数据可视化"></p><p>查看关系数据：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/neo4j/moviemtime-relationships.png" alt="关系数据可视化"></p><h2 id="数据查询可视化"><a href="#数据查询可视化" class="headerlink" title="数据查询可视化"></a>数据查询可视化</h2><p>查询可视化基于Bottle框架的Web服务。<br>参考：<a href="https://github.com/bubblewu/movie-neo4j/blob/master/mtime/mtime_graph_show.py" target="_blank" rel="external nofollow noopener noreferrer">GitHub: 可视化</a></p><p>效果如下图：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/neo4j/moviemtime-web.png" alt="电影信息可视化"></p><h2 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h2><ul><li><a href="https://github.com/bubblewu/movie-neo4j" target="_blank" rel="external nofollow noopener noreferrer">movie-neo4j</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Neo4j </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Neo4j </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>001 运行时数据区域和OutOfMemoryError异常</title>
      <link href="/ckbarvw2z0045yayd50uf5v6u/"/>
      <url>/ckbarvw2z0045yayd50uf5v6u/</url>
      
        <content type="html"><![CDATA[<p>本文主要讲解JVM运行时数据区域，并通过简单的案例来实现说明各个区域中的常见OOM异常。</p><a id="more"></a><h1 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h1><p>运行时数据区域图：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvm-rda.png" alt="运行时数据区域图"></p><p>Java内存区域：<br>JVM内存区域主要分为<code>线程私有区域</code>【程序计数器、虚拟机栈、本地方法栈】、<code>线程共享区域</code>【Java堆、方法区】、直接内存。<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvm-mind.png" alt="JVM内存导图"></p><ul><li><p>线程私有区域：<br>线程私有数据区域生命周期与线程相同, 依赖用户线程的启动/结束 而 创建/销毁(在Hotspot VM内,每个线程都与操作系统的本地线程直接映射, 因此这部分内存区域的存/否跟随本地线程的生/死对应)。</p></li><li><p>线程共享区域：<br>线程共享区域随虚拟机的启动/关闭而创建/销毁。</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvm-rda2.png" alt="运行时数据区域图2"></p><h1 id="JVM主要区域溢出异常"><a href="#JVM主要区域溢出异常" class="headerlink" title="JVM主要区域溢出异常"></a>JVM主要区域溢出异常</h1><p>在Java虚拟机规范中规定，除了<code>程序计数器</code>外，虚拟机的其他几个运行时区域都有发生OOM异常的可能，如：<strong>方法区（运行时常量池）、Java堆、虚拟机栈（局部变量表）、本地方法栈和直接内存。</strong></p><p>下面将通过案例来验证各个运行时区域的溢出异常，并分析我们来如何解决和避免这些异常。</p><blockquote><p>注：下面的代码基于<strong>JDK8</strong>进行开发测试；</p></blockquote><h2 id="线程独占区"><a href="#线程独占区" class="headerlink" title="线程独占区"></a>线程独占区</h2><h3 id="程序计数器（无OOM）"><a href="#程序计数器（无OOM）" class="headerlink" title="程序计数器（无OOM）"></a>程序计数器（无OOM）</h3><p>程序计数器（Program Counter Register）是一块较小的内存空间, 是当前线程所执行的字节码的行号指示器，每条线程都要有一个独立的程序计数器，这类内存也称为<code>线程私有</code>的内存。</p><ul><li>正在执行java方法的话，计数器记录的是虚拟机字节码指令的地址(当前指令的地址)。</li><li>如果是Native方法，则为空（undefined）。</li></ul><p>这个内存区域是唯一一个在虚拟机中没有规定任何OutOfMemoryError 情况的区域。</p><h3 id="虚拟机栈和本地方法栈溢出"><a href="#虚拟机栈和本地方法栈溢出" class="headerlink" title="虚拟机栈和本地方法栈溢出"></a>虚拟机栈和本地方法栈溢出</h3><h4 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h4><p><strong>虚拟机栈描述的是<code>Java方法</code>执行的线程内存模型</strong>。</p><h5 id="栈帧（Stack-Frame）："><a href="#栈帧（Stack-Frame）：" class="headerlink" title="栈帧（Stack Frame）："></a><code>栈帧（Stack Frame）</code>：</h5><p>每个方法被执行的时候，Java虚拟机都会同步创建一个<code>栈帧</code>用于<strong>存储局部变量表、操作数栈、动态连接、方法出口等信<br>息</strong>。<br>每一个方法被调用直至执行完毕的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。</p><p><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvm-stack.png" alt="栈帧"></p><h5 id="局部变量表："><a href="#局部变量表：" class="headerlink" title="局部变量表："></a><code>局部变量表</code>：</h5><p>局部变量表存放了编译期可知的：</p><ul><li>各种<code>Java虚拟机基本数据类型</code>：boolean、byte、char、short、int、 float、long、double；</li><li><code>对象引用</code> ：reference类型，它并不等同于对象本身，可能是一个指向对象起始地址的引用指针，也可能是指向一个代表对象的句柄或者其他与此对象相关的位置；</li><li><code>returnAddress类型</code>：指向了一条字节码指令的地址。</li></ul><p>这些数据类型在局部变量表中的存储空间以<code>局部变量槽(Slot)</code>来表示。<br><strong>其中64位长度的long和double类型的数据会占用两个变量槽，其余的数据类型只占用一个</strong>。<br>局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在栈帧中分配多大的局部变量空间是完全确定 的，<strong>在方法运行期间不会改变局部变量表的大小</strong>。</p><h5 id="两种异常：栈-堆溢出"><a href="#两种异常：栈-堆溢出" class="headerlink" title="两种异常：栈/堆溢出"></a>两种异常：栈/堆溢出</h5><ul><li>如果线程请求的栈深度大于虚拟机所允许的深度，将抛出<code>StackOverflowError异常</code>；</li><li>如果Java虚拟机栈容量可以动态扩展，当栈扩展时无法申请到足够的内存会抛出<code>OutOfMemoryError异常</code>。</li></ul><h4 id="虚拟机栈-amp-本地方法栈"><a href="#虚拟机栈-amp-本地方法栈" class="headerlink" title="虚拟机栈&amp;本地方法栈"></a>虚拟机栈&amp;本地方法栈</h4><p>Java虚拟机栈（Java Virtual Machine Stack）和本地方法栈（Native Method Stacks）非常相似，<code>都属于线程独占区</code>，区别是：</p><ul><li>虚拟机栈为虚拟机执行<code>Java方法（也就是字节码）服务</code>；</li><li>本地方法栈为虚拟机使用到的<code>本地方法（Native方法）服务</code>；</li></ul><p><strong>Hot-Spot虚拟机直接就把本地方法栈和虚拟机栈合二为一</strong>。与虚拟机栈一样，本地方法栈也会在栈深度溢出或者栈扩展失败时分别抛出<code>StackOverflowError</code>和<code>OutOfMemoryError</code>异常。</p><h4 id="虚拟机栈和本地方法栈溢出案例"><a href="#虚拟机栈和本地方法栈溢出案例" class="headerlink" title="虚拟机栈和本地方法栈溢出案例"></a>虚拟机栈和本地方法栈溢出案例</h4><h5 id="栈容量参数：-Xss"><a href="#栈容量参数：-Xss" class="headerlink" title="栈容量参数：-Xss"></a>栈容量参数：-Xss</h5><p>HotSpot虚拟机中并不区分虚拟机栈和本地方法栈，因此对于HotSpot来说，<code>-Xoss参数</code>(设置本地方法栈大小)虽然存在，但实际上是没有任何效果的，<code>栈容量只能由-Xss参数来设定</code>。</p><h5 id="栈-堆溢出的场景"><a href="#栈-堆溢出的场景" class="headerlink" title="栈/堆溢出的场景"></a>栈/堆溢出的场景</h5><p>《Java虚拟机规范》明确允许Java虚拟机实现自行选择是否支持栈的动态扩展，而HotSpot虚拟机的选择是不支持扩展。<br>所以除非<code>在创建线程申请内存时就因无法获得足够内存而出现 OutOfMemoryError异常</code>，否则<code>在线程运行时是不会因为扩展而导致内存溢出的，只会因为栈容量无法容纳新的栈帧而导致StackOverflowError异常</code>。</p><h5 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h5><p>将实验范围限制在<strong>单线程中操作</strong>，尝试下面两种行为是否能让HotSpot虚拟机产生OutOfMemoryError异常：</p><ul><li><p>使用<code>-Xss参数减少栈内存容量</code>。<br>结果：抛出StackOverflowError异常，异常出现时输出的堆栈深度相应缩小。 </p></li><li><p><code>定义大量的本地变量，增大此方法帧中本地变量表的长度</code>。<br>结果：抛出StackOverflowError异常，异常出现时输出的堆栈深度相应缩小。 </p></li></ul><h6 id="单线程下：使用-Xss参数减少栈内存容量（SOF异常）"><a href="#单线程下：使用-Xss参数减少栈内存容量（SOF异常）" class="headerlink" title="单线程下：使用-Xss参数减少栈内存容量（SOF异常）"></a>单线程下：使用<code>-Xss参数减少栈内存容量</code>（SOF异常）</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Java虚拟机栈和本地方法机栈异常（单线程操作下）</span></span><br><span class="line"><span class="comment"> * VM Args: -Xss160k（Mac 64Bit要求最低栈内存为160K）</span></span><br><span class="line"><span class="comment"> * 使用-Xss参数减少栈内存容量。</span></span><br><span class="line"><span class="comment"> * 结果：抛出StackOverflowError异常，异常出现时输出的堆栈深度相应缩小。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wugang</span></span><br><span class="line"><span class="comment"> * date: 2020-06-04 15:23</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VMStackSOF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stackLength = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stackLeak</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stackLength++;</span><br><span class="line">        stackLeak();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        VMStackSOF stackSOF = <span class="keyword">new</span> VMStackSOF();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stackSOF.stackLeak();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"stack length: "</span> + stackSOF.stackLength);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stack length: 773</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.StackOverflowError</span><br><span class="line">at com.bubble.jvm.error.VMStackSOF.stackLeak(VMStackSOF.java:16)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h6 id="单线程下：定义大量的本地变量，增大此方法帧中本地变量表的长度（SOF异常）"><a href="#单线程下：定义大量的本地变量，增大此方法帧中本地变量表的长度（SOF异常）" class="headerlink" title="单线程下：定义大量的本地变量，增大此方法帧中本地变量表的长度（SOF异常）"></a>单线程下：定义大量的本地变量，增大此方法帧中本地变量表的长度（SOF异常）</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Java虚拟机栈和本地方法机栈异常（单线程操作下）</span></span><br><span class="line"><span class="comment"> * 定义大量的本地变量，增大此方法帧中本地变量表的长度</span></span><br><span class="line"><span class="comment"> * 结果：抛出StackOverflowError异常，异常出现时输出的堆栈深度相应缩小。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wugang</span></span><br><span class="line"><span class="comment"> * date: 2020-06-04 15:23</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VMStackSOF02</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> stackLength = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> unused1, unused2, unused3, unused4, unused5, unused6, unused7, unused8, unused9, unused10,</span><br><span class="line">                unused11, unused12, unused13, unused14, unused15, unused16, unused17, unused18, unused19, unused20,</span><br><span class="line">                unused21, unused22, unused23, unused24, unused25, unused26, unused27, unused28, unused29, unused30,</span><br><span class="line">                unused31, unused32, unused33, unused34, unused35, unused36, unused37, unused38, unused39, unused40,</span><br><span class="line">                unused41, unused42, unused43, unused44, unused45, unused46, unused47, unused48, unused49, unused50,</span><br><span class="line">                unused51, unused52, unused53, unused54, unused55, unused56, unused57, unused58, unused59, unused60,</span><br><span class="line">                unused61, unused62, unused63, unused64, unused65, unused66, unused67, unused68, unused69, unused70,</span><br><span class="line">                unused71, unused72, unused73, unused74, unused75, unused76, unused77, unused78, unused79, unused80,</span><br><span class="line">                unused81, unused82, unused83, unused84, unused85, unused86, unused87, unused88, unused89, unused90,</span><br><span class="line">                unused91, unused92, unused93, unused94, unused95, unused96, unused97, unused98, unused99, unused100;</span><br><span class="line">        stackLength++;</span><br><span class="line">        test();</span><br><span class="line">        unused1 = unused2 = unused3 = unused4 = unused5 = unused6 = unused7 = unused8 = unused9 = unused10 = unused11 =</span><br><span class="line">                unused12 = unused13 = unused14 = unused15 = unused16 = unused17 = unused18 = unused19 = unused20 = unused21 = unused22 = unused23 = unused24 = unused25 = unused26 = unused27 = unused28 = unused29 = unused30 = unused31 = unused32 = unused33 = unused34 = unused35 = unused36 = unused37 = unused38 = unused39 = unused40 = unused41 = unused42 = unused43 = unused44 = unused45 = unused46 = unused47 = unused48 = unused49 = unused50 = unused51 = unused52 = unused53 = unused54 = unused55 = unused56 = unused57 = unused58 = unused59 = unused60 = unused61 = unused62 = unused63 = unused64 = unused65 = unused66 = unused67 = unused68 = unused69 = unused70 = unused71 = unused72 = unused73 = unused74 = unused75 = unused76 = unused77 = unused78 = unused79 = unused80 = unused81 = unused82 = unused83 = unused84 = unused85 = unused86 = unused87 = unused88 = unused89 = unused90 = unused91 = unused92 = unused93 = unused94 = unused95 = unused96 =</span><br><span class="line">                        unused97 = unused98 = unused99 = unused100 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            test();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"stack length: "</span> + stackLength);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stack length: 8121Exception in thread &quot;main&quot; </span><br><span class="line">java.lang.StackOverflowError</span><br><span class="line">at com.bubble.jvm.error.VMStackSOF02.test(VMStackSOF02.java:26)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h6 id="多线程下：OOM异常"><a href="#多线程下：OOM异常" class="headerlink" title="多线程下：OOM异常"></a>多线程下：OOM异常</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多线程下，Java虚拟机栈和本地方法栈OOM异常</span></span><br><span class="line"><span class="comment"> * VM Args:-Xss2M</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wugang</span></span><br><span class="line"><span class="comment"> * date: 2020-06-04 16:38</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VMStackOOM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dontStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stackLeakByThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(() -&gt; dontStop());</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        VMStackOOM vmStackOOM = <span class="keyword">new</span> VMStackOOM();</span><br><span class="line">        vmStackOOM.stackLeakByThread();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: unable to create native thread</span><br></pre></td></tr></table></figure><h6 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h6><p>实验结果表明：</p><ul><li>单线程下：</li></ul><p><strong>无论是由于栈帧太大还是虚拟机栈容量太小，当新的栈帧内存无法分配的时候，HotSpot虚拟机抛出的都是StackOverflowError异常。</strong><br>如果在允许动态扩展栈容量大小的虚拟机上，相同代码则会导致不一样的情况，如第二个代码（定义大量的本地变量，增大此方法帧中本地变量表的长度）示例就会抛出OutOfMemoryError异常。</p><ul><li>多线程下：<br>如果通过不断建立线程的方式，在HotSpot上也是可以产生内存溢出异常的，如第三个代码。<br>但是这样<strong>产生的内存溢出异常和栈空间是否足够并不存在任何直接的关系</strong>，<strong>主要取决于操作系统本身的内存使用状态</strong>。<br>甚至可以说，在这种情况下，<code>给每个线程的栈分配的内存越大，反而越容易产生内存溢出异常</code>。</li></ul><blockquote><p>因为：<strong>操作系统分配给每个进程的内存是有限制的</strong>。<br>如32位Windows的单个进程最大内存限制为2GB。<br>HotSpot虚拟机提供了参数可以控制Java堆和方法区这两部分的内存的最大值，<br>那<code>剩余的内存（由虚拟机栈和本地方法栈来分配的内存）</code>为<strong>2GB(操作系统限制)减去最大堆容量，再减去最大方法区容量</strong>。</p><blockquote><p>注意：由于程序计数器消耗内存很小，可以忽略掉，如果把直接内存和虚拟机进程本身耗费的内存也去掉的话。</p></blockquote><p>因此<code>为每个线程分配到的栈内存越大，可以建立的线程数量自 然就越少，建立线程时就越容易把剩下的内存耗尽</code>。</p></blockquote><ul><li>通过<code>减少内存</code>的手段来解决内存溢出的方式：<br>如果是建立过多线程导致的内存溢出，在不能减少线程数量或者更换64位虚拟机的情况下，就只<strong>通过<code>减少最大堆</code>和<code>减少栈容量</code>来换取更多的线程</strong>。</li></ul><h2 id="线程共享区"><a href="#线程共享区" class="headerlink" title="线程共享区"></a>线程共享区</h2><h3 id="Java堆溢出"><a href="#Java堆溢出" class="headerlink" title="Java堆溢出"></a>Java堆溢出</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>Java堆（Java Heap）是虚拟机管理的内存中的最大一块区域，也是垃圾回收的主要区域，它属于<code>线程共享区</code>，用于<code>存储对象实例</code>。</p><h4 id="Java堆时垃圾收集器管理的内存区域"><a href="#Java堆时垃圾收集器管理的内存区域" class="headerlink" title="Java堆时垃圾收集器管理的内存区域"></a>Java堆时垃圾收集器管理的内存区域</h4><p>Java堆也被称为GC堆（Garbage Collected Heap）。</p><ul><li><p>从<strong>回收内存角度</strong>来看：<br>垃圾收集器大部分都是基于<code>分代收集理论</code>设计的，会有 <strong>新生代、老年代、永久代（JDK8改为元空间）、Eden空间、From Survivor空间、To Survivor空间</strong>等名词。<br>这些区域划分仅仅是一部分垃圾收集器的共同特性或者说设计风格，而非某个Java虚拟机具体实现的固有内存布局，更不是《Java虚拟机规范》里对Java堆的进一步细致划分。</p></li><li><p>从<strong>分配内存角度</strong>来看：<br>所有线程共享的Java堆中可以划分出多个线程私有的<code>分配缓冲区</code>（TLAB, Thread Local Allocation Buffer），可以提升对象分配时的效率。<br>不过无论从什么角度，无论如 何划分，都不会改变Java堆中存储内容的共性，无论是哪个区域，<strong>存储的都只能是对象的实例</strong>，将Java 堆细分的目的只是为了更好地回收内存，或者更快地分配内存。</p></li></ul><h4 id="物理存储空间"><a href="#物理存储空间" class="headerlink" title="物理存储空间"></a>物理存储空间</h4><p>Java堆可以处于<strong>物理上不连续的内存空间</strong>中，但在逻辑上它应该被视为连续的。<br>就像我们用磁盘空间去存储文件一样，并不要求每个文件都连续存放。</p><blockquote><p>注意：但对于<strong>大对象</strong>(典型的如数组对象)，多数虚拟机实现出于实现简单、存储高效的考虑，很可能会要求连续的内存空间。</p></blockquote><h4 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h4><p>Java堆可以设置为固定大小，也可以为可动态扩展的。<br>通过参数<code>-Xmx</code>和<code>-Xms</code>来设定堆的最大和最小内存容量。<strong>将堆的最小值-Xms参数与最大值-Xmx参数设置为一样即可避免堆自动扩展</strong>。</p><p>如果<strong>在Java堆中没有内存完成实例分配，并且堆也无法再扩展时</strong>，Java虚拟机将会抛出<code>OutOfMemoryError异常</code>。</p><h4 id="为什么会堆溢出？"><a href="#为什么会堆溢出？" class="headerlink" title="为什么会堆溢出？"></a>为什么会堆溢出？</h4><p>当我们不断地创建新对象时，并且使GC Roots到对象之间有可达路径来避免垃圾回收机制清除这些对象，这时候，对象数量不断增加，总容量超过最大堆的容量限制后，就会发生内存溢出异常。</p><h4 id="OMM的两种情况"><a href="#OMM的两种情况" class="headerlink" title="OMM的两种情况"></a>OMM的两种情况</h4><p>可以通过内存映像分析工具对dump出的堆存储快照进行分析。<br>首先应确认内存中导致OOM的对象是否是必要的，也就是要先分清楚到底是出现了内存泄漏(Memory Leak)还是内存溢出(Memory Overflow)。</p><h5 id="内存泄露（Memory-Leak）"><a href="#内存泄露（Memory-Leak）" class="headerlink" title="内存泄露（Memory Leak）"></a>内存泄露（Memory Leak）</h5><p>如果是内存泄漏（<code>内存中的对象不是必须存活的，垃圾收集器未收集</code>），可进一步通过工具查看泄漏对象到GC Roots的引用链，找到泄漏对象是通过怎 样的引用路径、与哪些GC Roots相关联，才导致<code>垃圾收集器无法回收它们</code>，根据泄漏对象的类型信息 以及它到GC Roots引用链的信息，一般可以比较准确地定位到这些对象创建的位置，进而找出产生内存泄漏的代码的具体位置。</p><h5 id="内存溢出（Memory-Overflow）"><a href="#内存溢出（Memory-Overflow）" class="headerlink" title="内存溢出（Memory Overflow）"></a>内存溢出（Memory Overflow）</h5><p>如果不是内存泄漏，换句话说就是<code>内存中的对象确实都是必须存活的</code>，那就应当：</p><ul><li>检查Java虚拟机的堆参数(-Xmx与-Xms)设置，与机器的内存对比，看看是否还有向上调整的空间。</li><li>再从代码上检查 是否存在某些对象生命周期过长、持有状态时间过长、存储结构设计不合理等情况，尽量减少程序运行期的内存消耗。</li></ul><h4 id="溢出案例和dump快照分析"><a href="#溢出案例和dump快照分析" class="headerlink" title="溢出案例和dump快照分析"></a>溢出案例和dump快照分析</h4><p>使用虚拟机参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VM Args:-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError</span><br></pre></td></tr></table></figure><p>限制Java堆的大小为20M B，不可扩展。<br>通过参数<code>-XX:+HeapDumpOnOutOf-MemoryError</code>可以<strong>让虚拟机在出现内存溢出异常的时候Dump出当前的内存堆转储快照</strong>，以便进行事后分析。(文件存储在该项目父目录下，如：java_pid80802.hprof)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Java堆内存异常测试</span></span><br><span class="line"><span class="comment"> * VM Args: -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaHeapOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;OOMObject&gt; list = Lists.newArrayList();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> OOMObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid80802.hprof ...</span><br><span class="line">Heap dump file created [27964242 bytes in 0.193 secs]</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:3210)</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:3181)</span><br><span class="line">at java.util.ArrayList.grow(ArrayList.java:265)</span><br><span class="line">at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:239)</span><br><span class="line">at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:231)</span><br><span class="line">at java.util.ArrayList.add(ArrayList.java:462)</span><br><span class="line">at com.bubble.jvm.error.JavaHeapOOM.main(JavaHeapOOM.java:23)</span><br></pre></td></tr></table></figure><p>可以在目录/Users/wugang/code/java/multi-dev下看到java_pid80802.hprof文件。</p><ul><li>分析dump文件：<br>可以通过内存映像分析工具(如Eclipse Memory Analyzer)对Dump出来的堆转储快照进行分析，也可以通过JDK自带的工具jvisualvm来可视化分析。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 控制行执行命令</span><br><span class="line">jvisualvm</span><br></pre></td></tr></table></figure>会打开下面的窗口，打开对应的堆dump文件：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvisualvm-01.png" alt="jvisualvm-起始页"></li></ul><p>主要内容为：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvisualvm-02.png" alt="jvisualvm-概要"><br>由上图可知：导致 OutOfMemoryError 异常错误的线程是 main</p><p>查看dump的类信息：<br><img src="https://cdn.jsdelivr.net/gh/bubblewu/cdn/images/jvm/jvisualvm-03.png" alt="jvisualvm-类信息"><br>由上图可知：dump文件记录的堆中的实例总大小约19M，指定的堆的固定大小为20M。</p><blockquote><p>用第一行的实例大小除以百分比就能算出来：<br>堆中实例大小：12965216B/1024/1024=12.36M，占了总大小的65%。<br>堆中实例总大小：12.36M/0.65=19.02M</p></blockquote><p>说明：dump文件中的实例列表其实是<strong>反映了使用的堆的情况</strong>，而使用的堆内存并没有达到预先设置的最大堆内存，只是在申请堆内存的过程中超出了预先设置的最大堆内存，然后内存溢出。</p><h3 id="方法区和运行时常量池溢出"><a href="#方法区和运行时常量池溢出" class="headerlink" title="方法区和运行时常量池溢出"></a>方法区和运行时常量池溢出</h3><h4 id="方法区（Method-Area）"><a href="#方法区（Method-Area）" class="headerlink" title="方法区（Method Area）"></a>方法区（Method Area）</h4><p><code>方法区</code>与Java堆一样，属于<code>线程共享区</code>，它用于<strong>存储已被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存</strong>等数据。</p><p>《Java虚拟机规范》对方法区的约束是非常宽松的，除了和Java堆一样<strong>不需要连续的内存</strong>和<strong>可以选择固定大小</strong>或者<strong>可扩展</strong>外，甚至<strong>还可以选择不实现垃圾收集</strong>。</p><blockquote><p>注意：</p><ul><li><code>关于方法区和永久代（元空间）</code>：<br>在JDK8以前，很多人把方法区称呼为<code>永久代（Permanent Generation</code>，或将两者混为一谈。<br>本质上这两者并不是等价的，<strong>仅因为HotSpot使用永久代来实现方法区而已</strong>，使得HotSpot的垃圾收集器能够像管理Java堆一样管理这部分内存，省去专门为方法区编写内存管理代码的工作。<br>到了JDK 7的HotSpot，已经把原本放在永久代的字符串常量池、静态变量等移出；<br>而到了JDK 8，完全废弃了永久代的概念，改用与JRockit、J9一样在本地内存中实现的<code>元空间(Metaspace)</code>来代替，把JDK 7中永久代还剩余的内容(主要是类型信息)全部移到元空间中。</li></ul></blockquote><h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><h6 id="JDK8之前：老年代（Permanent-Gennration）"><a href="#JDK8之前：老年代（Permanent-Gennration）" class="headerlink" title="JDK8之前：老年代（Permanent Gennration）"></a>JDK8之前：老年代（Permanent Gennration）</h6><ul><li>如：<code>-XX:PermSize=10M</code> 指定老年代的初始空间大小（10M），以字节为单位。</li><li>如：<code>-XX:MaxPermSize=10M</code> 设置老年代最大值，默认是-1，即不限制，或者说只受限于本地内存大小。</li></ul><h6 id="JDK8始：元空间（Metaspace）"><a href="#JDK8始：元空间（Metaspace）" class="headerlink" title="JDK8始：元空间（Metaspace）"></a><code>JDK8始：元空间（Metaspace）</code></h6><p><strong>Metaspace使用的是本地内存，而不是堆内存</strong>，也就是说在<code>默认情况下Metaspace的大小只与本地内存大小有关</code>。</p><ul><li><code>-XX:MetaspaceSize</code>：指定<strong>元空间的初始空间大小</strong>，以字节为单位。</li></ul><p><strong>达到该值就会触发垃圾收集进行类型卸载，同时收集器会对该值进行调整</strong>：如果释放了大量的空间，就适当降低该值；如果释放了很少的空间，那么在不超过-XX:MaxMetaspaceSize(如果设置了的话)的情况下，适当提高该值。</p><blockquote><p>该值越大触发Metaspace GC的时机就越晚。<br>随着GC的到来，虚拟机会根据实际情况调控Metaspace的大小，可能增加上限也可能降低。<br>在默认情况下，这个值大小根据不同的平台在12M到20M浮动。<br>使用<code>java -XX:+PrintFlagsInitial</code>命令查看本机的初始化参数，-XX:Metaspacesize为21810376B（大约20.8M） 。</p></blockquote><ul><li><p><code>-XX:MaxMetaspaceSize</code>：设置<strong>元空间最大值</strong>，默认是-1，即不限制，或者说只受限于本地内存大小。</p><blockquote><p>防止因为某些情况导致Metaspace无限的使用本地内存，影响到其他程序。<br>在本机上该参数的默认值为4294967295B（大约4096MB）。</p></blockquote></li><li><p><code>-XX:MinMetaspaceFreeRatio</code>：作用是在Metaspace GC收集之后，控制最小的元空间剩余容量的百分比，可减少因为元空间不足导致的垃圾收集的频率。</p><blockquote><p>当进行过Metaspace GC之后，会计算当前Metaspace的空闲空间比。<br>如果空闲比小于这个参数，那么虚拟机将增长Metaspace的大小。<br>在本机该参数的默认值为40，也就是40%。<br>设置该参数可以控制Metaspace的增长的速度，太小的值会导致Metaspace增长的缓慢，Metaspace的使用逐渐趋于饱和，可能会影响之后类的加载。而太大的值会导致Metaspace增长的过快，浪费内存。</p></blockquote></li><li><p><code>-XX:MaxMetaspaceFreeRatio</code>：用于控制大的元空间剩余容量的百分比。</p><blockquote><p>当进行过Metaspace GC之后， 会计算当前Metaspace的空闲空间比，如果空闲比大于这个参数，那么虚拟机会释放Metaspace的部分空间。在本机该参数的默认值为70，也就是70%。</p></blockquote></li><li><p><code>-XX:MaxMetaspaceExpansion</code>： Metaspace增长时的最大幅度。在本机上该参数的默认值为5452592B（大约为5MB）。</p></li><li><p><code>-XX:MinMetaspaceExpansion</code>： Metaspace增长时的最小幅度。在本机上该参数的默认值为340784B（大约330KB为）。</p></li></ul><h5 id="运行时常量池（Runtime-Constant-Pool）"><a href="#运行时常量池（Runtime-Constant-Pool）" class="headerlink" title="运行时常量池（Runtime Constant Pool）"></a>运行时常量池（Runtime Constant Pool）</h5><p><strong>运行时常量池是方法区的一部分</strong>。<br>Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是<code>常量池表(Constant Pool Table)</code>，用于<strong>存放编译期生成的各种字面量与符号引用</strong>，这部分内容将在类加载后存放到方法区的运行时常量池中。</p><p>运行时常量池相对于Class文件常量池的另外一个重要特征是具备<strong>动态性</strong>，Java语言并不要求常量一定只有编译期才能产生，在运行期间也可以将新的常量放入池中，如使用<code>String类的intern()方法</code>。</p><h5 id="OOM异常"><a href="#OOM异常" class="headerlink" title="OOM异常"></a>OOM异常</h5><p>运行时常量池是方法区的一部分，自然受到方法区内存的限制，当常量池无法再申请到内存时会抛出OutOfMemoryError异常。</p><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>HotSpot从JDK7开始逐步“去永久代”的计划，并在JDK8中完全<strong>使用<code>元空间</code>来代替永久代</strong>。</p><h5 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法区的OOM异常：</span></span><br><span class="line"><span class="comment"> * - JDK8之前：指定老年代（方法区的大小固定为10M，不能进行自动扩展）</span></span><br><span class="line"><span class="comment"> * VM Args: -XX:PermSize=10M -XX:MaxPermSize=10M</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - JDK8：完全废除了老年代，用元空间代替。</span></span><br><span class="line"><span class="comment"> * VM Args: -XX:MetaspaceSize=10M -XX:MaxMetaspaceSize=10M</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wugang</span></span><br><span class="line"><span class="comment"> * date: 2020-06-04 18:44</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaMethodAreaOOM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 借助CGLib使得方法区出现内存溢出异常：</span></span><br><span class="line"><span class="comment">     * 方法区的主要职责是用于存放类型的相关信息：如类名、访问修饰符、常量池、字段描述、方法描述等。</span></span><br><span class="line"><span class="comment">     * 对于这部分区域的测试，基本的思路是：运行时产生大量的类去填满方法区，直到溢出为止。</span></span><br><span class="line"><span class="comment">     * 所以：可以借助CGLib直接操作字节码，运行时生成了大量的动态类。</span></span><br><span class="line"><span class="comment">     * 注意：</span></span><br><span class="line"><span class="comment">     * 当前的很多主流框架，如Spring、Hibernate对类进行增强时，都会使用到 CGLib这类字节码技术，</span></span><br><span class="line"><span class="comment">     * 当增强的类越多，就需要越大的方法区以保证动态生成的新类型可以载入内存。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">            enhancer.setSuperclass(OOMObject<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            enhancer.setUseCache(<span class="keyword">false</span>);</span><br><span class="line">            enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> methodProxy.invokeSuper(o, args);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            enhancer.create();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; net.sf.cglib.core.CodeGenerationException: java.lang.reflect.InvocationTargetException--&gt;null</span><br><span class="line">at net.sf.cglib.core.AbstractClassGenerator.generate(AbstractClassGenerator.java:348)</span><br><span class="line">at net.sf.cglib.proxy.Enhancer.generate(Enhancer.java:492)</span><br><span class="line">at net.sf.cglib.core.AbstractClassGenerator$ClassLoaderData.get(AbstractClassGenerator.java:117)</span><br><span class="line">at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:294)</span><br><span class="line">at net.sf.cglib.proxy.Enhancer.createHelper(Enhancer.java:480)</span><br><span class="line">at net.sf.cglib.proxy.Enhancer.create(Enhancer.java:305)</span><br><span class="line">at com.bubble.jvm.error.JavaMethodAreaOOM.main(JavaMethodAreaOOM.java:39)</span><br><span class="line">Caused by: java.lang.reflect.InvocationTargetException</span><br><span class="line">at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">at net.sf.cglib.core.ReflectUtils.defineClass(ReflectUtils.java:459)</span><br><span class="line">at net.sf.cglib.core.AbstractClassGenerator.generate(AbstractClassGenerator.java:339)</span><br><span class="line">... 6 more</span><br><span class="line">Caused by: java.lang.OutOfMemoryError: Metaspace</span><br><span class="line">at java.lang.ClassLoader.defineClass1(Native Method)</span><br><span class="line">at java.lang.ClassLoader.defineClass(ClassLoader.java:763)</span><br><span class="line">... 11 more</span><br></pre></td></tr></table></figure><h5 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法区（运行时常量池）的OOM异常，（方法区在JDK8后开始废除，之前也被称为永久代）</span></span><br><span class="line"><span class="comment"> * - 在JDK 6或更早之前的HotSpot虚拟机中，常量池都是分配在永久代中，</span></span><br><span class="line"><span class="comment"> * 我们可以通过-XX:PermSize和-XX:M axPermSize限制永久代的大小，即可间接限制其中常量池的容量。</span></span><br><span class="line"><span class="comment"> * 如：VM Args:-XX:PermSize=6M -XX:MaxPermSize=6M</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wugang</span></span><br><span class="line"><span class="comment"> * date: 2020-06-04 17:36</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuntimeConstantPoolOOM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JDK6来运行代码，抛出异常：</span></span><br><span class="line"><span class="comment">     * Exception in thread "main" java.lang.OutOfMemoryError: PermGen space</span></span><br><span class="line"><span class="comment">     * at java.lang.String.intern(Native Method)</span></span><br><span class="line"><span class="comment">     * 说明运行时常量池是属于方法区(即JDK 6的HotSpot虚拟机中的永久代)的一部分。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 注意：</span></span><br><span class="line"><span class="comment">     * 无论是在JDK7中继续使用-XX:MaxPermSize参数或者在JDK8及以上版本使用-XX:MaxMeta-spaceSize参数</span></span><br><span class="line"><span class="comment">     * 把方法区容量同样限制在6MB，也都不会重现JDK6中的溢出异常，循环将一直进行下去，永不停歇。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 因为自JDK7起，原本存放在永久代的字符串常量池被移至Java堆之中，</span></span><br><span class="line"><span class="comment">     * 所以在JDK7及以上版本，限制方法区的容量对该测试用例来说是毫无意义的。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 但使用-Xmx参数限制最大堆到6MB就能够看到下面两种运行结果之一，具体取决于哪里的对象分配时产生了溢出：</span></span><br><span class="line"><span class="comment">     * - OOM异常一：</span></span><br><span class="line"><span class="comment">     * Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</span></span><br><span class="line"><span class="comment">     * at java.base/java.lang.Integer.toString(Integer.java:440)</span></span><br><span class="line"><span class="comment">     * at java.base/java.lang.String.valueOf(String.java:3058)</span></span><br><span class="line"><span class="comment">     * - OOM异常二：</span></span><br><span class="line"><span class="comment">     * Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</span></span><br><span class="line"><span class="comment">     * at java.base/java.util.HashMap.resize(HashMap.java:699)</span></span><br><span class="line"><span class="comment">     * at java.base/java.util.HashMap.putVal(HashMap.java:658)</span></span><br><span class="line"><span class="comment">     * at java.base/java.util.HashMap.put(HashMap.java:607)</span></span><br><span class="line"><span class="comment">     * at java.base/java.util.HashSet.add(HashSet.java:220)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">runByJDK6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Set保持着常量池引用，避免Full GC回收常量池行为</span></span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="comment">// 在short范围内足以让6MB的PermSize产生OOM了</span></span><br><span class="line">        <span class="keyword">short</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            set.add(String.valueOf(i++).intern());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        runByJDK6();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="String-intern-方法"><a href="#String-intern-方法" class="headerlink" title="String::intern()方法"></a><code>String::intern()方法</code></h5><p><code>String::intern()</code>是一个Native方法，返回该对象在常量池中的引用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">intern</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>作用：如果字符串常量池中已经包含一个等于该String对象的字符串，则返回代表池中这个字符串的String对象的引用；否则，会将此String对象包含的字符串添加到常量池中，并且返回此String对象的引用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 在JDK 6中运行，会得到三个false；</span></span><br><span class="line"><span class="comment"> * 在JDK 6中，intern()方法会把首次遇到的字符串实例复制到永久代（方法区）的字符串常量池中存储，</span></span><br><span class="line"><span class="comment"> * 返回的也是永久代里面这个字符串实例的引用，而由StringBuilder创建的字符串对象实例在Java堆上，</span></span><br><span class="line"><span class="comment"> * 所以必然不可能是同一个引用，结果将返回false。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - 而在JDK 7后中运行，会得到一个true、一个false和一个true；</span></span><br><span class="line"><span class="comment"> * 因为JDK7中，intern()方法实现就不需要再拷贝字符串的实例到永久代了，既然字符串常量池已经移到Java堆中，</span></span><br><span class="line"><span class="comment"> * 那只需要在常量池里记录一下首次出现的实例引用即可。</span></span><br><span class="line"><span class="comment"> * 因此intern()返回的引用和由StringBuilder创建的那个字符串实例就是同一个。</span></span><br><span class="line"><span class="comment"> * 而对str2比较返回false，这是因为java这个字符串在执行StringBuilder()之前就已经出现过了，(在加载sun.misc.Version这个类的时候进入常量池的)</span></span><br><span class="line"><span class="comment"> * 字符串常量池中已经有它的引用，不符合intern()方法要求“首次遇到”的原则，“JVM调优”这个字符串则是首次出现的，因此结果返回true。</span></span><br><span class="line"><span class="comment"> * 而str3和str1一样，"JDKJVM"这个字符串则是首次出现。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String str1 = <span class="keyword">new</span> StringBuilder().append(<span class="string">"JVM"</span>).append(<span class="string">"调优"</span>).toString();</span><br><span class="line">    System.out.println(str1.intern() == str1);</span><br><span class="line">    <span class="comment">// java这个字符串在执行StringBuilder()之前就已经出现过了，在加载sun.misc.Version这个类的时候进入常量池的。</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 参考：https://www.zhihu.com/question/51102308/answer/124441115</span></span><br><span class="line"><span class="comment">     * sun.misc.Version类会在JDK类库的初始化过程中被加载并初始化，</span></span><br><span class="line"><span class="comment">     * 而在初始化时它需要对静态常量字段根据指定的常量值（ConstantValue）做默认初始化，</span></span><br><span class="line"><span class="comment">     * 此时被 sun.misc.Version.launcher 静态常量字段所引用的"java"字符串字面量就被intern到HotSpot VM的字符串常量池StringTable里了。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String str2 = <span class="keyword">new</span> StringBuilder().append(<span class="string">"ja"</span>).append(<span class="string">"va"</span>).toString();</span><br><span class="line">    System.out.println(str2.intern() == str2);</span><br><span class="line">    <span class="comment">// 而JDKJVM这个字符串则是首次出现</span></span><br><span class="line">    String str3 = <span class="keyword">new</span> StringBuilder().append(<span class="string">"JDK"</span>).append(<span class="string">"JVM"</span>).toString();</span><br><span class="line">    System.out.println(str3.intern() == str3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * java中的String是引用类型。创建的String对象，实际上存储的是一个地址。</span></span><br><span class="line"><span class="comment"> * 所以下面a和b都是引用类型，其存储的是字符串的地址。它们本身存储在Java虚拟机栈的局部变量表中。</span></span><br><span class="line"><span class="comment"> * - a：直接将字符串存储在常量池中，然后将a指向常量池种中的"JVM"。</span></span><br><span class="line"><span class="comment"> * - b：先将字符串"JVM"存储在常量池中，然后在heap中创建一个对象，该对象指向常量池中的"JVM"，最后将b指向heap中创建的这个对象。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 也就是说，a和b存储的内容是一样的，都是"JVM"，但地址不一样：a中保存的是常量池中"JVM"的地址，b保存的是heap中那个对象的地址，</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 双等于号"=="比较的是地址，equals()比较的是内容。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compareStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String a = <span class="string">"JVM"</span>;</span><br><span class="line">    <span class="comment">// new一个对象</span></span><br><span class="line">    String b = <span class="keyword">new</span> String(<span class="string">"JVM"</span>);</span><br><span class="line">    <span class="comment">// == 比较地址是否相等</span></span><br><span class="line">    <span class="comment">// 都在运行时常量池中</span></span><br><span class="line">    System.out.println(<span class="string">"JVM"</span> == a); <span class="comment">// true</span></span><br><span class="line">    System.out.println(a.intern() == a); <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// a为字符字面量（存储在运行时常量池中），b为对象（存储在堆中），所以不等。</span></span><br><span class="line">    System.out.println(a == b); <span class="comment">// false</span></span><br><span class="line">    System.out.println(a.intern() == b); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    System.out.println(a.equals(b));  <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="其他（不受JVM-GC管理区域）"><a href="#其他（不受JVM-GC管理区域）" class="headerlink" title="其他（不受JVM GC管理区域）"></a>其他（不受JVM GC管理区域）</h2><h3 id="本机直接内存溢出"><a href="#本机直接内存溢出" class="headerlink" title="本机直接内存溢出"></a>本机直接内存溢出</h3><h4 id="直接内存（Direct-Memory）"><a href="#直接内存（Direct-Memory）" class="headerlink" title="直接内存（Direct Memory）"></a>直接内存（Direct Memory）</h4><p>直接内存并不是虚拟机运行时数据区的一部分，也不是《Java虚拟机规范》中定义的内存区域。</p><p>容量大小可通过<code>-XX:MaxDirectMemorySize</code>参数来指定，如果不去指定，则默认与Java堆最大值(由-Xmx指定)一致。</p><h5 id="NIO-New-Input-Output-类"><a href="#NIO-New-Input-Output-类" class="headerlink" title="NIO(New Input/Output)类"></a>NIO(New Input/Output)类</h5><p>NIO引入了一种<code>基于通道(Channel)</code>与<code>缓冲区 (Buffer)</code>的I/O方式，它可以<strong>使用Native函数库直接分配堆外内存</strong>，然后<strong>通过一个存储在Java堆里面的DirectByteBuffer对象作为这块内存的引用</strong>进行操作。<br>这样能在一些场景中显著提高性能，因为避免了在Java堆和Native堆中来回复制数据。</p><h5 id="OOM异常-1"><a href="#OOM异常-1" class="headerlink" title="OOM异常"></a>OOM异常</h5><p>当各个内存区域总和大于物理内存限制(包括物理的和操作系统级的限制)，从而导致动态扩展时出现 OutOfMemoryError异常。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 直接内存OOM异常：使用unsafe分配本机内存</span></span><br><span class="line"><span class="comment"> * VM Args: -Xmx20M -XX:MaxDirectMemorySize=10M</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wugang</span></span><br><span class="line"><span class="comment"> * date: 2020-06-04 19:43</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectMemoryOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _1MB = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 越过了DirectByteBuffer类直接通过反射获取Unsafe实例进行内存分配。</span></span><br><span class="line"><span class="comment">     * （Unsafe类的getUnsafe()方法指定只有引导类加载器才会返回实例，体现了设计者希望只有虚拟机标准类库里面的类才能使用Unsafe的功能，在JDK 10时才将Unsafe的部分功能通过VarHandle开放给外部使用）</span></span><br><span class="line"><span class="comment">     * 因为虽然使用DirectByteBuffer分配内存也会抛出内存溢出异常，但它抛出异常时并没有真正向操作系统申请分配内存，</span></span><br><span class="line"><span class="comment">     * 而是通过计算得知内存无法分配就会在代码里手动抛出溢出异常，真正申请分配内存的方法是Unsafe::allocateMemory ()。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 抛出异常：</span></span><br><span class="line"><span class="comment">     * Exception in thread "main" java.lang.OutOfMemoryError</span></span><br><span class="line"><span class="comment">     * at sun.misc.Unsafe.allocateMemory(Native Method)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        Field unsafeField = Unsafe.class.getDeclaredFields()[0];</span><br><span class="line">        unsafeField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Unsafe unsafe = (Unsafe) unsafeField.get(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            unsafe.allocateMemory(_1MB);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由直接内存导致的内存溢出，一个明显的特征是在Heap Dump文件中不会看见有什么明显的异常情况。<br>如果发现内存溢出之后产生的Dump文件很小，而程序中又直接或间接使用了DirectMemory(典型的间接使用就是NIO)，那就可以考虑重点检查一下直接内存方面的原因了。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生产者-消费者案例</title>
      <link href="/ckbarvw0y000fyayd2z9y58tz/"/>
      <url>/ckbarvw0y000fyayd2z9y58tz/</url>
      
        <content type="html"><![CDATA[<p>基于Java的生产者-消费者模式代码实现，可以此为Demo来用于具体的实际业务。</p><a id="more"></a><ul><li>生产者-消费者demo<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.time.Duration;</span><br><span class="line">import java.time.Instant;</span><br><span class="line">import java.util.*;</span><br><span class="line">import java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line">import java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line">import java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 推荐服务：生产者-消费者模式</span><br><span class="line"> *</span><br><span class="line"> * @author bubble</span><br><span class="line"> * date: 2018-10-22 15:03</span><br><span class="line"> **&#x2F;</span><br><span class="line">@Deprecated</span><br><span class="line">public class RecService &#123;</span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(RecService.class);</span><br><span class="line">    &#x2F;&#x2F; 日志打印间隔</span><br><span class="line">    private static int DEFAULT_LOG_INTERVAL &#x3D; 1000 * 10;</span><br><span class="line">    &#x2F;&#x2F; 队列默认处理容量，为避免队列扩容造成额外性能损耗，默认不扩容，达到当前大小，进入等待，消费者处理一部分数据之后，生产者继续生产</span><br><span class="line">    private static int DEFAULT_QUEUE_DISPOSE_SIZE &#x3D; 1000 * 10;</span><br><span class="line">    &#x2F;&#x2F; 队列默认容量</span><br><span class="line">    private static int DEFAULT_QUEUE_SIZE &#x3D; DEFAULT_QUEUE_DISPOSE_SIZE + 200;</span><br><span class="line">    &#x2F;&#x2F; 每个队列满时默认休眠时间</span><br><span class="line">    private static int DEFAULT_SLEEP_TIME &#x3D; 1000;</span><br><span class="line">    &#x2F;&#x2F; 线程池默认消费者数量</span><br><span class="line">    private static int DEFAULT_CONSUMER_NUM &#x3D; 2;</span><br><span class="line">    &#x2F;&#x2F; 用户的phoneId队列</span><br><span class="line">    private LinkedBlockingQueue&lt;Long&gt; phoneIdQueue &#x3D; new LinkedBlockingQueue&lt;&gt;(DEFAULT_QUEUE_SIZE);</span><br><span class="line">    private Long STOP_FLAG &#x3D; -1L;</span><br><span class="line">    private Map&lt;Long, List&lt;FlightInfoBean&gt;&gt; flightInfoMap; &#x2F;&#x2F; 用户航班信息</span><br><span class="line"></span><br><span class="line">    private Map&lt;Long, List&lt;FlightInfoBean&gt;&gt; getFlightInfoMap() &#123;</span><br><span class="line">        return flightInfoMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void setFlightInfoMap(Map&lt;Long, List&lt;FlightInfoBean&gt;&gt; flightInfoMap) &#123;</span><br><span class="line">        this.flightInfoMap &#x3D; flightInfoMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private RecJobBean recJob;</span><br><span class="line">    private TipRecService tipRecService;</span><br><span class="line">    private CarRecService carRecService;</span><br><span class="line">    private HotelRecService hotelRecService;</span><br><span class="line"></span><br><span class="line">    public RecService(RecJobBean recJob) &#123;</span><br><span class="line">        this.recJob &#x3D; recJob;</span><br><span class="line">        switch (recJob) &#123;</span><br><span class="line">            case TIP:</span><br><span class="line">                tipRecService &#x3D; Optional.ofNullable(tipRecService).orElse(new TipRecService());</span><br><span class="line">                break;</span><br><span class="line">            case CAR:</span><br><span class="line">                carRecService &#x3D; Optional.ofNullable(carRecService).orElse(new CarRecService());</span><br><span class="line">                break;</span><br><span class="line">            case HOTEL:</span><br><span class="line">                hotelRecService &#x3D; Optional.ofNullable(hotelRecService).orElse(new HotelRecService());</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                LOGGER.error(&quot;please enter the correct rec type, error type: &#123;&#125; &quot;, recJob.getType());</span><br><span class="line">                System.exit(0);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void rec(Map&lt;Long, List&lt;FlightInfoBean&gt;&gt; userFlightMap, int top) &#123;</span><br><span class="line">        LOGGER.info(&quot;start &#123;&#125; rec job.&quot;, recJob.getType());</span><br><span class="line">        if (userFlightMap &#x3D;&#x3D; null || userFlightMap.isEmpty()) &#123;</span><br><span class="line">            LOGGER.error(&quot;user flight is empty, rec job for &#123;&#125; exit.&quot;, recJob.getType());</span><br><span class="line">            System.exit(0);</span><br><span class="line">        &#125;</span><br><span class="line">        setFlightInfoMap(userFlightMap);</span><br><span class="line">        UserProducer userProducer &#x3D; new UserProducer();</span><br><span class="line">        userProducer.setName(&quot;producer&quot;);</span><br><span class="line">        userProducer.start();</span><br><span class="line">        UserConsumer userConsumer &#x3D; new UserConsumer(recJob, top);</span><br><span class="line">        ThreadPoolExecutor poolExecutor &#x3D; userConsumer.consumerAndRec();</span><br><span class="line">        threadMonitor(poolExecutor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 监控ThreadPoolExecutor线程池，无活动线程就关闭线程池连接；</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private void threadMonitor(ThreadPoolExecutor executor) &#123;</span><br><span class="line">        Runnable runnable &#x3D; () -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(2);</span><br><span class="line">                while (executor.getActiveCount() &gt; 0) &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(1);</span><br><span class="line">                &#125;</span><br><span class="line">                executor.shutdown();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                LOGGER.error(&quot;thread monitor error.&quot;, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        new Thread(runnable).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 生产者: 可用phoneId集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    class UserProducer extends Thread &#123;</span><br><span class="line">        int i &#x3D; 0;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            addUser();</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;&#x2F; 给每个线程都在队列（FIFO）末尾添加标识</span><br><span class="line">                phoneIdQueue.put(STOP_FLAG);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                LOGGER.error(&quot;save phoneId error.&quot;, e);</span><br><span class="line">            &#125;</span><br><span class="line">            LOGGER.info(&quot;[&#123;&#125;] thread altogether produces &#123;&#125; data&quot;, this.getName(), i);</span><br><span class="line">            LOGGER.info(&quot;[&#123;&#125;] thread produces done.&quot;, this.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void addUser() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                int step &#x3D; 0;</span><br><span class="line">                LOGGER.info(&quot;add &#123;&#125; user in producer queue.&quot;, getFlightInfoMap().size());</span><br><span class="line">                Iterator iter &#x3D; getFlightInfoMap().entrySet().iterator();</span><br><span class="line"></span><br><span class="line">                while (iter.hasNext()) &#123;</span><br><span class="line">                    Map.Entry entry &#x3D; (Map.Entry) iter.next();</span><br><span class="line">                    long uid &#x3D; (long) entry.getKey();</span><br><span class="line">                    phoneIdQueue.put(uid);</span><br><span class="line">                    step++;</span><br><span class="line">                    while (phoneIdQueue.size() &gt; DEFAULT_QUEUE_DISPOSE_SIZE) &#123;</span><br><span class="line">                        Thread.sleep(DEFAULT_SLEEP_TIME);</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (step &#x3D;&#x3D; DEFAULT_LOG_INTERVAL) &#123;</span><br><span class="line">                        i +&#x3D; step;</span><br><span class="line">                        step &#x3D; 0;</span><br><span class="line">                        LOGGER.info(&quot;[&#123;&#125;] thread has produced &#123;&#125; pieces of data&quot;, this.getName(), i);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                i +&#x3D; step;</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                LOGGER.error(&quot;save phoneId error.&quot;, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 消费者：取phoneId并进行推荐</span><br><span class="line">     *&#x2F;</span><br><span class="line">    class UserConsumer &#123;</span><br><span class="line">        private int top;</span><br><span class="line">        private RecJobBean recJob;</span><br><span class="line"></span><br><span class="line">        public UserConsumer(RecJobBean recJob, int top) &#123;</span><br><span class="line">            this.recJob &#x3D; recJob;</span><br><span class="line">            this.top &#x3D; top;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public ThreadPoolExecutor consumerAndRec() &#123;</span><br><span class="line">            ThreadPoolExecutor poolExecutor &#x3D; new ThreadPoolExecutor(DEFAULT_CONSUMER_NUM,</span><br><span class="line">                    DEFAULT_CONSUMER_NUM &lt;&lt; 1,</span><br><span class="line">                    60 * 60 * 4,</span><br><span class="line">                    TimeUnit.SECONDS,</span><br><span class="line">                    new ArrayBlockingQueue&lt;&gt;(50),</span><br><span class="line">                    new ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">            LOGGER.info(&quot;Consumer start.&quot;);</span><br><span class="line"></span><br><span class="line">            for (int i &#x3D; 0; i &lt; DEFAULT_CONSUMER_NUM; i++) &#123;</span><br><span class="line">                Thread t &#x3D; new Thread() &#123;</span><br><span class="line">                    int step &#x3D; 0;</span><br><span class="line">                    int consumerNum &#x3D; 0;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        while (!this.isInterrupted()) &#123;</span><br><span class="line">                            Long phoneId;</span><br><span class="line">                            try &#123;</span><br><span class="line">                                phoneId &#x3D; phoneIdQueue.take();</span><br><span class="line">                                if (phoneId.equals(STOP_FLAG)) &#123;</span><br><span class="line">                                    &#x2F;&#x2F; 该线程取到-1，说明产品队列中已无产品，可以结束线程，但是可能还有其他线程存活，需要通知其他线程已无数据</span><br><span class="line">                                    &#x2F;&#x2F; 因此，插入-1，同时跳出循环，线程归还线程池，等待监控线程发现其处于非活动状态，将其销毁，最终销毁线程池</span><br><span class="line">                                    phoneIdQueue.put(STOP_FLAG);</span><br><span class="line">                                    LOGGER.info(&quot;[&#123;&#125;] thread consumes done.&quot;, this.getName());</span><br><span class="line">                                    break;</span><br><span class="line">                                &#125;</span><br><span class="line">                                recOneUser(recJob, phoneId, top);</span><br><span class="line"></span><br><span class="line">                                consumerNum++;</span><br><span class="line">                                step++;</span><br><span class="line">                                if (step &#x3D;&#x3D; DEFAULT_LOG_INTERVAL) &#123;</span><br><span class="line">                                    step &#x3D; 0;</span><br><span class="line">                                    LOGGER.info(&quot;[&#123;&#125;] thread has consumed &#123;&#125; pieces of data&quot;, this.getName(), consumerNum);</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                                LOGGER.error(&quot;read data from phoneIdQueue error.&quot;, e);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        LOGGER.info(&quot;[&#123;&#125;] thread altogether consumes &#123;&#125; user data&quot;, this.getName(), consumerNum);</span><br><span class="line">                        LOGGER.info(&quot;RecConsumer end.&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                t.setName(&quot;RecConsumer-&quot; + i);</span><br><span class="line">                poolExecutor.execute(t);</span><br><span class="line">            &#125;</span><br><span class="line">            return poolExecutor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private void recOneUser(RecJobBean recJob, long uid, int top) &#123;</span><br><span class="line">        Instant begin &#x3D; Instant.now();</span><br><span class="line">        List&lt;FlightInfoBean&gt; userFlightInfoList &#x3D; getFlightInfoMap().get(uid);</span><br><span class="line">        if (userFlightInfoList !&#x3D; null &amp;&amp; !userFlightInfoList.isEmpty()) &#123;</span><br><span class="line">            List&lt;TipsUserLinkBean&gt; recItems &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">            switch (recJob) &#123;</span><br><span class="line">                case TIP:</span><br><span class="line">                    recItems &#x3D; tipRecService.rec(uid, userFlightInfoList, top);</span><br><span class="line">                    break;</span><br><span class="line">                case CAR:</span><br><span class="line">                    recItems &#x3D; carRecService.rec(uid, userFlightInfoList);</span><br><span class="line">                    break;</span><br><span class="line">                case HOTEL:</span><br><span class="line">                    recItems &#x3D; hotelRecService.rec(uid, userFlightInfoList, top);</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    LOGGER.error(&quot;please enter the correct rec type, error type: &#123;&#125; &quot;, recJob.getType());</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            LOGGER.info(&quot;&#123;&#125; rec for user [&#123;&#125;] count is &#123;&#125;, costs &#123;&#125; ms&quot;, recJob.getType(), uid, recItems.size(), Duration.between(begin, Instant.now()).toMillis());</span><br><span class="line">            Instant saveStart &#x3D; Instant.now();</span><br><span class="line">            try &#123;</span><br><span class="line">                DataService.saveTipsUserLink(recItems, recJob);</span><br><span class="line">            &#125; catch (java.lang.NullPointerException np) &#123;</span><br><span class="line">                LOGGER.error(&quot;user [&#123;&#125;] saveTipsUserLink error.&quot;, uid, np);</span><br><span class="line">            &#125;</span><br><span class="line">            LOGGER.info(&quot;&#123;&#125; rec for user [&#123;&#125;] count is &#123;&#125;, save costs &#123;&#125; ms&quot;, recJob.getType(), uid, recItems.size(), Duration.between(saveStart, Instant.now()).toMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>celery和redis交互全流程解析</title>
      <link href="/ckbarvw1l001kyaydh0a4fqt9/"/>
      <url>/ckbarvw1l001kyaydh0a4fqt9/</url>
      
        <content type="html"><![CDATA[<p>celery 和 redis 之间交互的基本原理</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> celery 和 redis 之间交互的基本原理：</span><br><span class="line">1、当发起一个 task 时，会向 redis 的 celery key 中插入一条记录。</span><br><span class="line">2、如果这时有正在待命的空闲 worker，这个 task 会立即被 worker 领取。</span><br><span class="line">3、如果这时没有空闲的 worker，这个 task 的记录会保留在 celery key 中。</span><br><span class="line">4、这时会将这个 task 的记录从 key celery 中移除，并添加相关信息到 unacked 和 unacked_index 中。</span><br><span class="line">5、worker 根据 task 设定的期望执行时间执行任务，如果接到的不是延时任务或者已经超过了期望时间，则立刻执行。</span><br><span class="line">6、worker 开始执行任务时，通知 redis。（如果设置了 CELERY_ACKS_LATE &#x3D; True 那么会在任务执行结束时再通知）</span><br><span class="line">7、redis 接到通知后，将 unacked 和 unacked_index 中相关记录移除。</span><br><span class="line">8、如果在接到通知前，worker 中断了，这时 redis 中的 unacked 和 unacked_index 记录会重新回到 celery key 中。(这个回写的操作是由 worker 在 “临死” 前自己完成的，所以在关闭 worker 时为防止任务丢失，请务必使用正确的方法停止它，如: celery multi stop w1 -A proj1)</span><br><span class="line">9、在 celery key 中的 task 可以再次重复上述 2 以下的流程。</span><br><span class="line">10、celery 只是利用 redis 的 list 类型，当作个简单的 Queue，并没有使用消息订阅等功能</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------</span><br><span class="line"></span><br><span class="line">1、需要配置celery的backend，backend的作用就是存储任务执行结果。</span><br><span class="line">2、当celery key中的任务成功被worker认领并且执行成功，celery会向配置好的bachend中，写入以task_id为key。</span><br><span class="line">3、所以，可以通过查看bachend中是否有以task_id为key的对象来判断task是否执行成功。</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="<https://github.com/wongqingbin/blog/issues>" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> celery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>copy</title>
      <link href="/ckbarvw15000vyayd2sf94mhq/"/>
      <url>/ckbarvw15000vyayd2sf94mhq/</url>
      
        <content type="html"><![CDATA[<p>图片增加容量大小使用方法</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy 1M.jpg /b + 5M.file /b 6M.jpg</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">copy /b 1M.jpg + 5M.file 6M.jpg</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="<https://github.com/wongqingbin/blog/issues>" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> copy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git修改用户名密码</title>
      <link href="/ckbarvw1m001oyaydhe6xdj9h/"/>
      <url>/ckbarvw1m001oyaydhe6xdj9h/</url>
      
        <content type="html"><![CDATA[<p>用户使用git时的使用免密拉取和上传，修改免密设置，取消免密设置</p><a id="more"></a><h2 id="第一次输入密码之后自动免密"><a href="#第一次输入密码之后自动免密" class="headerlink" title="第一次输入密码之后自动免密"></a>第一次输入密码之后自动免密</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git 默认即支持首次输入用户名密码，后续自动记忆，使用免密设置</span></span><br></pre></td></tr></table></figure><h2 id="取消免密设置"><a href="#取消免密设置" class="headerlink" title="取消免密设置"></a>取消免密设置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> credential.helper store</span><br><span class="line"><span class="comment"># 使用 --global 参数则全局生效，不适用则针对当前目录下的.git生效</span></span><br></pre></td></tr></table></figure><h2 id="设置免密"><a href="#设置免密" class="headerlink" title="设置免密"></a>设置免密</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br><span class="line"><span class="comment"># 使用 --global 参数则全局生效，不适用则针对当前目录下的.git生效</span></span><br></pre></td></tr></table></figure><h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大多公司的账户密码考虑到安全性，隔段时间便会失效，需更改密码</span></span><br><span class="line"><span class="comment"># 这个时候大多git默认已经记忆上次用户名和密码，且不用跳出输入用户和密码的弹窗</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 取消免密功能，使它能正确弹出用户名和密码框</span></span><br><span class="line">git config --global --<span class="built_in">unset</span> credential.helper store</span><br><span class="line"><span class="comment"># 2. 使用git拉取或提交代码，相当于首次提交 会自动弹出用户名密码弹窗，输入即可</span></span><br><span class="line"><span class="comment"># 3. 再次打开免密功能，记忆第二步的用户名和密码</span></span><br><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure><h2 id="win图形化修改git提交密码"><a href="#win图形化修改git提交密码" class="headerlink" title="win图形化修改git提交密码"></a>win图形化修改git提交密码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置路径</span></span><br><span class="line"><span class="comment"># 控制面板 --&gt; 用户账号 --&gt; 凭据管理器 --&gt; windows凭据 --&gt; 修改对应的git地址的用户名和密码后保存即可</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="<https://github.com/wongqingbin/blog/issues>" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Charles</title>
      <link href="/ckbarvw0w000eyayd63i6aore/"/>
      <url>/ckbarvw0w000eyayd63i6aore/</url>
      
        <content type="html"><![CDATA[<p>Charles 注册码</p><a id="more"></a><h2 id="Charles-注册码"><a href="#Charles-注册码" class="headerlink" title="Charles 注册码"></a>Charles 注册码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CCF</span><br><span class="line">4cfbb2ea5c75c77858</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="<https://github.com/wongqingbin/blog/issues>" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Charles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> licenses </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac安装并配置Jenkins</title>
      <link href="/ckbarvw10000jyaydaxnw43ky/"/>
      <url>/ckbarvw10000jyaydaxnw43ky/</url>
      
        <content type="html"><![CDATA[<p>Mac使用Homebrew包管理器安装并配置管理Jenkins</p><a id="more"></a><h2 id="mac安装Jenkins"><a href="#mac安装Jenkins" class="headerlink" title="mac安装Jenkins"></a>mac安装Jenkins</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Mac安装JDK并配置环境变量</span></span><br><span class="line"><span class="comment"># 2.安装Jenkins</span></span><br><span class="line">brew install jenkins</span><br><span class="line">brew services start jenkins  <span class="comment"># 命令会自动设置为开机启动</span></span><br><span class="line">brew services stop jenkins</span><br><span class="line">brew services restart jenkins</span><br><span class="line"><span class="comment"># 局域网访问:</span></span><br><span class="line"><span class="comment"># 使用brew安装jenkins会避免很多其他安装方式产生的用户权限问题，但是会将httpListenAddress默认设置为127.0.0.1，这样我们虽然可以在本地用localhost:8080访问，但是本机和局域网均无法用ip访问。解决办法为修改两个路径下的plist配置。并重启</span></span><br><span class="line"><span class="comment"># ～/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</span></span><br><span class="line"><span class="comment"># /usr/local/opt/jenkins/homebrew.mxcl.jenkins.plist</span></span><br><span class="line"><span class="comment"># 将上面两个plist中的httpListenAddress后的ip地址，修改为本机IP或者0.0.0.0即可。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消开机启动</span></span><br><span class="line">sudo launchctl unload -w /Library/LaunchDaemons/org.jenkins-ci.plist </span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">sudo launchctl load -w /Library/LaunchDaemons/org.jenkins-ci.plist</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Jenkins </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>interview</title>
      <link href="/ckbarvw0z000iyaydhl5afzxr/"/>
      <url>/ckbarvw0z000iyaydhl5afzxr/</url>
      
        <content type="html"><![CDATA[<p>Interview</p><a id="more"></a><h2 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 冒泡排序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data)<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">            <span class="keyword">if</span> data[j] &gt; data[j + <span class="number">1</span>]:</span><br><span class="line">                data[j], data[j + <span class="number">1</span>] = data[j + <span class="number">1</span>], data[j]</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        print(<span class="string">'第&#123;0&#125;次排序: &#123;1&#125;'</span>.format(len(data)-i, data))</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 装饰器单例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    _instance = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> _instance:</span><br><span class="line">            _instance.setdefault(cls, cls(*args, **kwargs))</span><br><span class="line">        <span class="keyword">return</span> _instance.get(cls)</span><br><span class="line">    <span class="keyword">return</span> get_instance</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################ sql</span></span><br><span class="line"><span class="comment"># 添加</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablename(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="number">1</span>,w)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablename <span class="keyword">values</span>(<span class="number">1</span>,w)</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line"><span class="keyword">update</span> tablename <span class="keyword">set</span> 字段名=<span class="string">'newvalue'</span> <span class="keyword">where</span></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tablename <span class="keyword">where</span></span><br><span class="line"><span class="comment"># 查找</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tablename <span class="keyword">where</span></span><br><span class="line"><span class="comment"># 分组</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 字段名 <span class="keyword">having</span> <span class="keyword">avg</span>()</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############# Linux</span></span><br><span class="line"><span class="comment"># 查看进程</span></span><br><span class="line">ps -ef | grep <span class="string">'kafka'</span>  <span class="comment"># 显示PID</span></span><br><span class="line"><span class="comment"># 杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看日志后十行file.log</span></span><br><span class="line">tail -n 10 -f file.log  <span class="comment"># tail -f  == tailf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制</span></span><br><span class="line">cp -a oldfile newfolder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查端口号是否被占用</span></span><br><span class="line">netstat -anp | grep 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># mkdir 创建目录</span></span><br><span class="line">mkdir a</span><br><span class="line">mkdir -p a/b/c  <span class="comment"># 创建多级目录时使用 -p 命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rm 删除目录、文件</span></span><br><span class="line">rm -rf a/b/c  f  <span class="comment"># 不提醒确认则删除     shell脚本中常用  r是目录也删除，递归删除</span></span><br><span class="line">rm -r a/b/c     <span class="comment"># 提醒用户是否确认删除  命令行使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cat 查看文件</span></span><br><span class="line"><span class="comment"># cat -n [文件名]  -n 显示行号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cp  拷贝文件</span></span><br><span class="line">cp A.txt b.txt</span><br><span class="line">cp a b</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo  $PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep</span></span><br><span class="line">cat -n A.txt | grep filter  <span class="comment"># 只显示filter内容</span></span><br><span class="line">cat -n A.txt | grep -v filter  <span class="comment"># -v不显示filter内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># find</span></span><br><span class="line">fine /root -name A.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># ps  查看进程PID</span></span><br><span class="line">ps -ef | grep mongo</span><br><span class="line"></span><br><span class="line"><span class="comment"># kill -9 结束进程(根据PID)</span></span><br><span class="line"><span class="built_in">kill</span> -9 [PID]</span><br><span class="line"></span><br><span class="line"><span class="comment"># mv</span></span><br><span class="line">mv a.txt /a/b</span><br><span class="line"></span><br><span class="line"><span class="comment"># netstat 检查端口是否被占用</span></span><br><span class="line">netstat -anp | grep 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum search package</span></span><br><span class="line"><span class="comment"># yum install package</span></span><br><span class="line"><span class="comment"># yum uninstall package</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sed 修改文本</span></span><br><span class="line">sed -e <span class="string">'s/oldstr/newstr/g'</span> A.txt  <span class="comment"># 's'字符串 'g'全局替换</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tar</span></span><br><span class="line">tar -zcvf a.tar.gz /root/a  <span class="comment">#归档打包</span></span><br><span class="line">tar -zxvf a.tar.gz /root/a  <span class="comment">#解压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># awk 处理带格式文件文本</span></span><br><span class="line"><span class="built_in">kill</span> -9 `ps | grep bash | awk <span class="string">' '</span> <span class="string">'&#123;print $1&#125;'</span>`  <span class="comment">#  === kill -9 PID</span></span><br><span class="line"><span class="comment"># awk ' ' 空格分割字符串</span></span><br><span class="line"><span class="comment"># awk '&#123;print $1&#125;' 打印或取值第一个</span></span><br><span class="line"><span class="comment"># ` ` 代表执行代码块获取执行结果，优先执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nohub 不挂起进行 命令行保护进程启动程序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># head 从头开始查看文件前10行</span></span><br><span class="line">head -n 10 a.log</span><br><span class="line"><span class="comment"># tail</span></span><br><span class="line">tail -n 10 a.log  <span class="comment"># 从末尾开始查看文件最后10行</span></span><br><span class="line">tail -f a.log     <span class="comment"># 实时查看末尾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># less</span></span><br><span class="line"><span class="comment"># more</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># touch、vi 创建文件</span></span><br><span class="line">touch a.txt</span><br><span class="line">vi a.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># history  查看命令行的历史命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod  赋权限</span></span><br><span class="line">chmod 777 A.txt</span><br><span class="line">chmod -x A.txt</span><br><span class="line"><span class="comment"># x可执行权限 r只读 w写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rz 上传  yum install lrzsz</span></span><br><span class="line"><span class="comment"># sz 下载</span></span><br><span class="line"><span class="comment"># scp 文件传输</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># wc</span></span><br><span class="line">wc -l a/b/A.txt  <span class="comment"># 统计文件行数</span></span><br><span class="line"><span class="comment"># du</span></span><br><span class="line">du -sh A.txt   <span class="comment"># 查看文件大小</span></span><br><span class="line">du -sh /a/b    <span class="comment"># 查看目录大小</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    测试用例八大要素</span><br><span class="line">用例编号</span><br><span class="line">操作步骤</span><br><span class="line">测试标题</span><br><span class="line">重要级别</span><br><span class="line">前置条件</span><br><span class="line">测试输入</span><br><span class="line">所属模块</span><br><span class="line">预期结果</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">黑盒测试用例设计方法包括等价类划分法、边界值分析法、错误推测法、因果图法、判定表驱动法、正交试验设计法、功能图法、场景图法等。</span><br><span class="line"></span><br><span class="line">白盒子测试方法：（强度由低到高）语句覆盖、判定覆盖、条件覆盖、判定条件覆盖、条件组合覆盖、路径覆盖。</span><br><span class="line"></span><br><span class="line">测试人员经常用到的有等价类，边界值，场景法，因果图法。</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Interview </category>
          
      </categories>
      
      
        <tags>
            
            <tag> interview </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins部署Python</title>
      <link href="/ckbarvw10000kyaydbdqx5vt4/"/>
      <url>/ckbarvw10000kyaydbdqx5vt4/</url>
      
        <content type="html"><![CDATA[<p>Jenkins部署 - 使用shell脚本后台守护进程运行</p><a id="more"></a><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保证程序后台运行不杀死  和 nohub、&amp; 一同使用</span></span><br><span class="line">BUILD_ID=dontKillMe</span><br><span class="line"></span><br><span class="line"><span class="comment"># source /root/.bash_profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止服务(先杀死Python当前运行的进程)</span></span><br><span class="line"><span class="comment"># ps -ef | grep python3 | grep -v grep | awk -F ' ' '&#123;print $2&#125;' | xargs kill -9</span></span><br><span class="line">pid=`ps -ef | grep python3 | grep -v grep | awk -F <span class="string">' '</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="variable">$&#123;pid[@]&#125;</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$p</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除目录</span></span><br><span class="line"><span class="keyword">if</span> [ -d /root/Jenkins/production ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">rm -rf /root/Jenkins/production</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新部署目录</span></span><br><span class="line">mkdir -p /root/Jenkins/production</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入部署目录</span></span><br><span class="line"><span class="built_in">cd</span> /root/Jenkins/production</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取代码</span></span><br><span class="line">git <span class="built_in">clone</span> &lt;url&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入</span></span><br><span class="line"><span class="built_in">cd</span> &lt;proj_path&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动  BUILD_ID=dontKillMe  保证程序后台运行不杀死  和 nohub、&amp; 一同使用</span></span><br><span class="line">nohup python3 app.py &amp;</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Jenkins </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 firewalld</title>
      <link href="/ckbarvw14000tyaydgnk51yty/"/>
      <url>/ckbarvw14000tyaydgnk51yty/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 通过防火墙开放指定端口</p><a id="more"></a><h2 id="firewall-cmd"><a href="#firewall-cmd" class="headerlink" title="firewall-cmd"></a>firewall-cmd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看开通端口列表</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开放80端口</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=80/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭80端口</span></span><br><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启防火墙生效</span></span><br><span class="line">systemctl restart firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># PS: </span></span><br><span class="line"><span class="comment"># firewalld配置的防火墙策略也分为两种模式</span></span><br><span class="line"><span class="comment"># 1、runtime，当前生效，重启后失效</span></span><br><span class="line"><span class="comment"># 2、permanent，当前失效，重启后生效，为了让permanet生效，一般会执行friewall-cmd --reload，使其立即生效</span></span><br></pre></td></tr></table></figure><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul><li>Linux上新的防火墙软件，和iptables差不多的工具。firewalld是centos7的一大特性，两大优点：支持动态更新，不用重启服务；加入了防火墙的“zone”概念。</li><li>firewalld能动态修改单条规则，不像iptables，修改规则后必须全部刷新才能生效。</li><li>firewalld在使用上要比iptables人性化很多。firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的netfilter来实现，也就是说firewalld和iptables一样，他们的作用都是用于维护规则，而真正使用规则干活的是内核的netfilter。</li></ul><hr><ul><li><p>rpm -qa | grep firewalld | 查看是否安装</p></li><li><p>yum install firewalld 安装</p></li><li><p>rpm -qa | grep firewall-config 查看是否安装图形界面</p></li><li><p>yum install firewall-config 如果需要图形界面的话，需要安装</p></li><li><p>systemctl start firewalld 启动</p></li><li><p>systemctl restart firewalld 重启</p></li><li><p>systemctl disable firewalld 停止</p></li><li><p>systemctl stop firewalld 禁用</p></li><li><p>systemctl status firewalld | - firewall-cmd --state 查看状态</p></li><li><p>firewall-cmd --list-ports 查看开通端口列表</p></li><li><p>firewall-cmd --zone=public --remove-port=80/tcp --permanent 关闭端口</p></li><li><p>firewall-cmd --permanent --zone=public --add-port=80/tcp 开通端口</p></li><li><p>firewall-cmd --get-default-zone 查看default zone</p></li><li><p>firewall-cmd --get-active-zones 查看active zone</p></li><li><p>备注：--zone #作用域 --add-port=80/tcp #添加端口，格式为：端口/通讯协议 --permanent #永久生效，没有此参数重启后失效<br>firewall防火墙默认的几个zone（由firewalld 提供的区域按照从不信任到信任的顺序排序）</p></li></ul><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> firewalld </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 network</title>
      <link href="/ckbarvw1h001ayayd3yvicofd/"/>
      <url>/ckbarvw1h001ayayd3yvicofd/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7网络配置(Mac虚拟机下的共享配置)</p><a id="more"></a><h2 id="编辑网络配置文件"><a href="#编辑网络配置文件" class="headerlink" title="编辑网络配置文件"></a>编辑网络配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑配置文件ifcfg-eth0 ifcfg-eth1 ...</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"><span class="comment"># 复制以下项</span></span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NOBOOT=yes</span><br><span class="line">IPADDR=192.168.10.192</span><br><span class="line">NETMASK=255.255.252.0</span><br><span class="line">GATEWAY=192.168.10.254</span><br><span class="line">DNS1=192.168.10.3</span><br><span class="line">DNS2=223.6.6.6</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启网络CentOS7网络后生效</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><h2 id="参数解读"><a href="#参数解读" class="headerlink" title="参数解读"></a>参数解读</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注：这里面的IP地址，子网掩码，GATE ，DNS都按照主机的配置。</span></span><br><span class="line"><span class="comment"># 之后，重启一下虚拟机应该就可以。</span></span><br><span class="line"><span class="comment"># 之后，ping下主机IP地址，ping 下局域网其他主机IP地址，再ping下外网ip地址，可以的话就算成功</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从dhcp改成static</span></span><br><span class="line">BOOTPROTO=static</span><br><span class="line"><span class="comment"># 从no改成yes。系统将在启动时自动开启该接口。</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="comment"># 设置IP地址</span></span><br><span class="line">IPADDR=</span><br><span class="line"><span class="comment"># 设置子网掩码</span></span><br><span class="line">NETMASK=</span><br><span class="line"><span class="comment"># 设置网关</span></span><br><span class="line">GATEWAY=</span><br><span class="line"><span class="comment"># 设置DNS</span></span><br><span class="line">DNS1=</span><br><span class="line">DNS2=</span><br><span class="line"><span class="comment"># 表示该接口将通过该配置文件进行设置，而不是通过网络管理器进行管理</span></span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line"></span><br><span class="line"><span class="comment">####################################</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 时间时区调整</title>
      <link href="/ckbarvw1p0021yayd9ze9hvwu/"/>
      <url>/ckbarvw1p0021yayd9ze9hvwu/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 调整时间为中国时区时间</p><a id="more"></a><h2 id="启用NTP同步"><a href="#启用NTP同步" class="headerlink" title="启用NTP同步"></a>启用NTP同步</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装ntp服务</span></span><br><span class="line">yum install ntp</span><br><span class="line"><span class="comment"># 开机启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> ntpd</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl start ntpd</span><br><span class="line"><span class="comment"># 更改时区</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-timezone Asia/Shanghai</span><br><span class="line"><span class="comment"># 启用ntp同步</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-ntp yes</span><br><span class="line"><span class="comment"># 同步时间</span></span><br><span class="line">ntpq -p</span><br></pre></td></tr></table></figure><h2 id="timedatectl-命令同步时区"><a href="#timedatectl-命令同步时区" class="headerlink" title="timedatectl 命令同步时区"></a>timedatectl 命令同步时区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取时间  等同于 timedatectl status</span></span><br><span class="line">timedatectl</span><br><span class="line"><span class="comment"># 设置时间</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-time <span class="string">"YYYY-MM-DD HH:MM:SS"</span></span><br><span class="line"><span class="comment"># 列出所有时区</span></span><br><span class="line">timedatectl list-timezones</span><br><span class="line"><span class="comment"># 更改时区</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-timezone Asia/Shanghai</span><br><span class="line"><span class="comment"># 或   ln -sf /usr/share/zoneinfor/Asia/Shanghai /etc/localtime     </span></span><br><span class="line">设置是否与NTP服务器同步 //yes或者no</span><br><span class="line">timedatectl <span class="built_in">set</span>-ntp yes</span><br><span class="line"><span class="comment"># 将硬件时钟调整为与本地时钟一致</span></span><br><span class="line">hwclock --systohc --localtime 或 timedatectl <span class="built_in">set</span>-local-rtc 1</span><br><span class="line"><span class="comment"># 注，硬件时钟默认使用UTC时间，因为硬件时钟不能保存时区和夏令时调整，修改后就无法从硬件时钟中读取出准确标准时间，因此不建议修改。修改后系统会出现警告。</span></span><br><span class="line"><span class="comment"># 将硬件时间设置成 UTC</span></span><br><span class="line">hwclock --systohc --utc 或 timedatectl <span class="built_in">set</span>-local-rtc 1</span><br><span class="line"><span class="comment"># 显示硬件时间：</span></span><br><span class="line">hwclock --show</span><br><span class="line"><span class="comment"># 设置硬件时间：</span></span><br><span class="line">hwclock --<span class="built_in">set</span> --date ‘08/02/2012 12:00:00’</span><br><span class="line"><span class="comment"># 将硬件时间同步到系统时间：</span></span><br><span class="line">hwclock --hctosys</span><br><span class="line"><span class="comment"># 强制把系统时间写入CMOS：</span></span><br><span class="line"><span class="comment"># clock -w</span></span><br></pre></td></tr></table></figure><h2 id="时钟概念"><a href="#时钟概念" class="headerlink" title="时钟概念"></a>时钟概念</h2><ul><li><p>在CentOS 6版本，时间设置有date、hwclock命令，从CentOS 7开始，使用了一个新的命令timedatectl。</p></li><li><p>（1）UTC<br>整个地球分为二十四时区，每个时区都有自己的本地时间。在国际无线电通信场合，为了统一起见，使用一个统一的时间，称为通用协调时(UTC, Universal Time Coordinated)。</p></li><li><p>（2）GMT<br>格林威治标准时间 (Greenwich Mean Time)指位于英国伦敦郊区的皇家格林尼治天文台的标准时间，因为本初子午线被定义在通过那里的经线。(UTC与GMT时间基本相同，本文中不做区分)</p></li><li><p>（3）CST<br>中国标准时间 (China Standard Time)【GMT + 8 = UTC + 8 = CST】</p></li><li><p>（4）DST<br>夏令时(Daylight Saving Time) 指在夏天太阳升起的比较早时，将时钟拨快一小时，以提早日光的使用。（中国不使用）</p></li><li><p>硬件时钟：<br>RTC(Real-Time Clock)或CMOS时钟，一般在主板上靠电池供电，服务器断电后也会继续运行。仅保存日期时间数值，无法保存时区和夏令时设置。</p></li><li><p>系统时钟：<br>一般在服务器启动时复制RTC时间，之后独立运行，保存了时间、时区和夏令时设置。</p></li></ul><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> timedatectl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 nginx</title>
      <link href="/ckbarvw1f0017yayd4jkqaz8q/"/>
      <url>/ckbarvw1f0017yayd4jkqaz8q/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 安装 nginx</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖包 c编译gcc依赖</span></span><br><span class="line">yum install gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br><span class="line"><span class="comment"># 下载安装包</span></span><br><span class="line">wget -c https://nginx.org/download/nginx-1.12.0.tar.gz</span><br><span class="line"><span class="comment"># 解压安装包</span></span><br><span class="line">tar -zxvf nginx-1.12.0.tar.gz</span><br><span class="line"><span class="comment"># 进入安装包</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.12.0</span><br><span class="line"><span class="comment"># 编译预处理</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># 编译并安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入nginx目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin/</span><br><span class="line"><span class="comment"># 启动nginx ./nginx [-s stop|reload]</span></span><br><span class="line">./nginx -s reload -t</span><br></pre></td></tr></table></figure><h2 id="配置文件路径说明"><a href="#配置文件路径说明" class="headerlink" title="配置文件路径说明"></a>配置文件路径说明</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./configure           \</span></span><br><span class="line"><span class="comment"># --prefix=/etc/nginx                     \</span></span><br><span class="line"><span class="comment"># --sbin-path=/usr/sbin/nginx                 \</span></span><br><span class="line"><span class="comment"># --conf-path=/etc/nginx/nginx.conf              \</span></span><br><span class="line"><span class="comment"># --error-log-path=/var/log/nginx/error.log          \</span></span><br><span class="line"><span class="comment"># --http-log-path=/var/log/nginx/access.log          \</span></span><br><span class="line"><span class="comment"># --pid-path=/var/run/nginx.pid                \</span></span><br><span class="line"><span class="comment"># --lock-path=/var/run/nginx.lock</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 mongodb</title>
      <link href="/ckbarvw1a0011yayd5ev06lmm/"/>
      <url>/ckbarvw1a0011yayd5ev06lmm/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 安装 mongodb</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 repo文件</span></span><br><span class="line">touch /etc/yum.repos.d/mongodb-org-4.0.repo</span><br><span class="line"><span class="comment"># 配置 repo文件(复制以下内容到.repo文件)</span></span><br><span class="line">[mongodb-org-4.0]</span><br><span class="line">name=MongoDB Repository</span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb- org/4.0/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo yum install -y mongodb-org</span><br><span class="line"><span class="comment"># 编辑配置文件: 修改绑定地址为0.0.0.0 </span></span><br><span class="line">vim /etc/mongod.conf</span><br><span class="line"><span class="comment"># 启动、停止、重启</span></span><br><span class="line">service mongod start/stop/restart</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.修改数据和日志的存储位置</span></span><br><span class="line"><span class="comment"># bin目录下增加mongodb.conf文件</span></span><br><span class="line"><span class="comment"># 内容：</span></span><br><span class="line">port=27017</span><br><span class="line">dbpath=/usr/<span class="built_in">local</span>/mongodb/data/</span><br><span class="line">logpath=/usr/<span class="built_in">local</span>/mongodb/<span class="built_in">log</span>/mongodb.log</span><br><span class="line">fork = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 释义：</span></span><br><span class="line"><span class="comment"># port: 数据库服务使用端口</span></span><br><span class="line"><span class="comment"># dbpath: 数据存放的文件位置</span></span><br><span class="line"><span class="comment"># logpath: 日志文件的存放位置</span></span><br><span class="line"><span class="comment"># fork: 后台守护进程运行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动命令：</span></span><br><span class="line">./mongod -f mongodb.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭方式：</span></span><br><span class="line">./mongo</span><br><span class="line"><span class="comment"># &gt;</span></span><br><span class="line"><span class="comment"># &gt;use admin</span></span><br><span class="line"><span class="comment"># &gt;db.shutdownServer()</span></span><br></pre></td></tr></table></figure><h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">yum erase $(rpm -qa | grep mongodb-org)</span><br><span class="line">rm -r /var/<span class="built_in">log</span>/mongodb</span><br><span class="line">rm -r /var/lib/mongo</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mongodb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 kafka</title>
      <link href="/ckbarvw1b0015yayd76q40mpr/"/>
      <url>/ckbarvw1b0015yayd76q40mpr/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 安装 kafka，简单配置使用kafka</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载安装包</span></span><br><span class="line">wget http://mirror.bit.edu.cn/apache/kafka/2.2.0/kafka_2.12-2.2.0.tgz</span><br><span class="line"><span class="comment"># 解压安装包</span></span><br><span class="line">tar -xzf kafka_2.12-2.2.0.tgz</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动zookeeper</span></span><br><span class="line">bin/zookeeper-server-start.sh config/zookeeper.properties</span><br><span class="line"><span class="comment"># 启动kafka</span></span><br><span class="line">bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建topic</span></span><br><span class="line">bin/kafka-topics.sh --create --bootstrap-server localhost:9092 -- replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 列出topic</span></span><br><span class="line">bin/kafka-topics.sh --list --bootstrap-server localhost:9092</span><br><span class="line"><span class="comment"># 发送消息</span></span><br><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 接收消息</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 -- topic <span class="built_in">test</span> --from-beginning</span><br></pre></td></tr></table></figure><h2 id="启动zookeeper"><a href="#启动zookeeper" class="headerlink" title="启动zookeeper"></a>启动zookeeper</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1</span></span><br><span class="line">bin/zookeeper-server-start.sh config/zookeeper.properties</span><br><span class="line"><span class="comment"># 2 守护进程启动方式 防止挂掉</span></span><br><span class="line">bin/zookeeper-server-start.sh -daemon config/zookeeper.properties</span><br></pre></td></tr></table></figure><h2 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1</span></span><br><span class="line">bin/kafka-server-start.sh config/server.properties</span><br><span class="line"><span class="comment"># 2 守护进程启动方式 防止挂掉</span></span><br><span class="line">bin/kafka-server-start.sh -daemon config/server.properties</span><br></pre></td></tr></table></figure><h2 id="查看topic列表"><a href="#查看topic列表" class="headerlink" title="查看topic列表"></a>查看topic列表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure><h2 id="创建topic"><a href="#创建topic" class="headerlink" title="创建topic"></a>创建topic</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --from-beginning</span><br></pre></td></tr></table></figure><h2 id="关闭kafka"><a href="#关闭kafka" class="headerlink" title="关闭kafka"></a>关闭kafka</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-stop.sh</span><br></pre></td></tr></table></figure><h2 id="关闭zookeeper"><a href="#关闭zookeeper" class="headerlink" title="关闭zookeeper"></a>关闭zookeeper</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zookeeper-server-stop.sh</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7  c 编译依赖安装</title>
      <link href="/ckbarvw12000oyayda65nanbm/"/>
      <url>/ckbarvw12000oyayda65nanbm/</url>
      
        <content type="html"><![CDATA[<p>Linux使用源码安装软件时，需要c编译时，首先安装c编译依赖</p><a id="more"></a><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line">yum install pcre-devel</span><br><span class="line">yum install zlib zlib-devel</span><br><span class="line">yum install openssl openssl-devel</span><br><span class="line"></span><br><span class="line">yum install gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gcc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 python</title>
      <link href="/ckbarvw1i001dyaydbagicfj8/"/>
      <url>/ckbarvw1i001dyaydbagicfj8/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 yum安装 python3.6</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖包</span></span><br><span class="line">yum install -y openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel</span><br><span class="line"><span class="comment"># 下载安装包 </span></span><br><span class="line">wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz</span><br><span class="line"><span class="comment"># 解压安装包 </span></span><br><span class="line">tar -xzvf Python-3.6.5.tgz</span><br><span class="line"><span class="comment"># 进入安装目录 </span></span><br><span class="line"><span class="built_in">cd</span> Python-3.6.5</span><br><span class="line"><span class="comment"># 编译预处理 </span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/python</span><br><span class="line"><span class="comment"># 编译并安装 </span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="修改Linux的Python版本默认为Python3"><a href="#修改Linux的Python版本默认为Python3" class="headerlink" title="修改Linux的Python版本默认为Python3"></a>修改Linux的Python版本默认为Python3</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux默认Python为2.7</span></span><br><span class="line"><span class="comment"># 建立新安装的python3.6.5的软连接</span></span><br><span class="line">$ ln -s /usr/python/bin/python3 /usr/bin/python3</span><br></pre></td></tr></table></figure><h2 id="python3添加环境变量"><a href="#python3添加环境变量" class="headerlink" title="python3添加环境变量"></a>python3添加环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># PATH=$PATH:$HOME/bin:/opt/python3.6.5/bin  # opt需修改为自己安装的Python所在目录</span></span><br><span class="line"><span class="comment"># export PATH</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 --version</span><br><span class="line"></span><br><span class="line">python --version</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 JDK</title>
      <link href="/ckbarvw13000pyaydd3rd8po3/"/>
      <url>/ckbarvw13000pyaydd3rd8po3/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 安装 JDK1.8 并配置环境变量</p><a id="more"></a><h2 id="yum安装jdk"><a href="#yum安装jdk" class="headerlink" title="yum安装jdk"></a>yum安装jdk</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk*</span><br></pre></td></tr></table></figure><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># set java environment</span></span><br><span class="line"><span class="comment"># JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.181-3.b13.el7_5.x86_64</span></span><br><span class="line"><span class="comment"># PATH=$PATH:$JAVA_HOME/bin</span></span><br><span class="line"><span class="comment"># CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span></span><br><span class="line"><span class="comment"># export JAVA_HOME  CLASSPATH  PATH</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java --version</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jdk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>curl发送HTTP请求</title>
      <link href="/ckbarvw19000zyayd9sw493um/"/>
      <url>/ckbarvw19000zyayd9sw493um/</url>
      
        <content type="html"><![CDATA[<p>使用curl发送HTTP请求，用于简单验证接口连接性。</p><a id="more"></a><h2 id="GET-请求示例"><a href="#GET-请求示例" class="headerlink" title="GET 请求示例"></a>GET 请求示例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET请求 -i</span></span><br><span class="line">curl -i &lt;url&gt;</span><br><span class="line"><span class="comment"># 返回示例：</span></span><br><span class="line"><span class="comment"># HTTP/1.0 200 OK</span></span><br><span class="line"><span class="comment"># Content-Type: application/json</span></span><br><span class="line"><span class="comment"># Content-Length: 151</span></span><br><span class="line"><span class="comment"># Server: Werkzeug/0.8.3 Python/2.7.3</span></span><br><span class="line"><span class="comment"># Date: Mon, 20 May 2013 05:21:50 GMT</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "data": &#123;</span></span><br><span class="line"><span class="comment">#     "description": "Need to find a good Python tutorial on the web",</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   "code": 200</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure><h2 id="POST-请求示例"><a href="#POST-请求示例" class="headerlink" title="POST 请求示例"></a>POST 请求示例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST请求示例 -i</span></span><br><span class="line">curl -i -H <span class="string">"Content-Type: application/json"</span> -X POST -d <span class="string">'&#123;"data":"data"&#125;'</span> &lt;url&gt;</span><br><span class="line"><span class="comment"># HTTP/1.0 201 Created</span></span><br><span class="line"><span class="comment"># Content-Type: application/json</span></span><br><span class="line"><span class="comment"># Content-Length: 104</span></span><br><span class="line"><span class="comment"># Server: Werkzeug/0.8.3 Python/2.7.3</span></span><br><span class="line"><span class="comment"># Date: Mon, 20 May 2013 05:56:21 GMT</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "data": &#123;</span></span><br><span class="line"><span class="comment">#     "description": "Need to find a good Python tutorial on the web",</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   "code": 200</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure><h2 id="curl-带密码请求"><a href="#curl-带密码请求" class="headerlink" title="curl 带密码请求"></a>curl 带密码请求</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -u username:password -i url</span></span><br><span class="line">curl -u miguel:python -i &lt;url&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTP/1.0 200 OK</span></span><br><span class="line"><span class="comment"># Content-Type: application/json</span></span><br><span class="line"><span class="comment"># Content-Length: 316</span></span><br><span class="line"><span class="comment"># Server: Werkzeug/0.8.3 Python/2.7.3</span></span><br><span class="line"><span class="comment"># Date: Mon, 20 May 2013 06:46:45 GMT</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "data": &#123;</span></span><br><span class="line"><span class="comment">#     "description": "Need to find a good Python tutorial on the web",</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   "code": 200</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> curl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh-keygen</title>
      <link href="/ckbarvw1j001fyayd90y791oh/"/>
      <url>/ckbarvw1j001fyayd90y791oh/</url>
      
        <content type="html"><![CDATA[<p>ssh-keygen简单用法<br>本文主要针对ssh-keygen配置GitHub Pages使用ssh免密部署<br>ssh秘钥登录特点：1.安全；2.免输密码。</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh-keygen为ssh自带命令，Mac、Linux、Ubuntu等都自带</span></span><br></pre></td></tr></table></figure><h2 id="检查是否配置过ssh服务"><a href="#检查是否配置过ssh服务" class="headerlink" title="检查是否配置过ssh服务"></a>检查是否配置过ssh服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mac、linux、ubuntu</span></span><br><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">ls</span><br><span class="line"><span class="comment"># id_rsa  id_rsa.pub  known_hosts</span></span><br><span class="line"><span class="comment"># 如果有id_rsa  id_rsa.pub，证明以前曾经配置过，如果忘记曾经配置过，请删除此两项</span></span><br></pre></td></tr></table></figure><h2 id="配置ssh"><a href="#配置ssh" class="headerlink" title="配置ssh"></a>配置ssh</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email@example.com"</span></span><br><span class="line"><span class="comment"># 后面全部enter，不选择任何选项，最后生成的秘钥为无密码密钥</span></span><br></pre></td></tr></table></figure><h2 id="查看公钥和私钥"><a href="#查看公钥和私钥" class="headerlink" title="查看公钥和私钥"></a>查看公钥和私钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看公钥</span></span><br><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看私钥</span></span><br><span class="line">cat ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><h2 id="服务器配置公钥"><a href="#服务器配置公钥" class="headerlink" title="服务器配置公钥"></a>服务器配置公钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以github为例</span></span><br><span class="line"><span class="comment"># 配置路径：Setting -&gt; SSH and GPG keys -&gt; New SSH key or Add SSH key</span></span><br><span class="line"><span class="comment"># title可以随便起（尽量和自己的私钥所在电脑相关联）</span></span><br><span class="line"><span class="comment"># Key:    # 复制id_rsa.pub文件的全部内容</span></span><br><span class="line"><span class="comment"># 最后保存即可</span></span><br></pre></td></tr></table></figure><h2 id="测试是否连通"><a href="#测试是否连通" class="headerlink" title="测试是否连通"></a>测试是否连通</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以github为例</span></span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh-keygen </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scp</title>
      <link href="/ckbarvw1k001iyaydh269beic/"/>
      <url>/ckbarvw1k001iyaydh269beic/</url>
      
        <content type="html"><![CDATA[<p>Linux scp 命令用于 Linux 之间复制文件和目录。<br>scp 是 secure copy 的缩写, scp 是 linux 系统下基于 ssh 登陆进行安全的远程文件拷贝命令。<br>scp 是加密的，rcp 是不加密的，scp 是 rcp 的加强版。<br>scp [可选参数] file_source file_target</p><a id="more"></a><h2 id="从本地复制到远程Linux"><a href="#从本地复制到远程Linux" class="headerlink" title="从本地复制到远程Linux"></a>从本地复制到远程Linux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制文件1 (自动重命名)</span></span><br><span class="line">scp local_file remote_username@remote_ip:remote_file</span><br><span class="line"><span class="comment"># 复制文件2 (无重命名)</span></span><br><span class="line">scp local_file remote_username@remote_ip:remote_folder</span><br><span class="line"><span class="comment"># PS: 需要输入远程ssh登录的密码；如果未指定用户名，则需要输入用户名和密码</span></span><br></pre></td></tr></table></figure><h2 id="从远程Linux复制到本地"><a href="#从远程Linux复制到本地" class="headerlink" title="从远程Linux复制到本地"></a>从远程Linux复制到本地</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制文件1 (自动重命名)</span></span><br><span class="line">scp remote_username@remote_ip:remote_file local_file</span><br><span class="line"><span class="comment"># 复制文件2 (无重命名)</span></span><br><span class="line">scp remote_username@remote_ip:remote_folder local_folder</span><br><span class="line"><span class="comment"># PS: 需要输入远程ssh登录的密码；如果未指定用户名，则需要输入用户名和密码</span></span><br></pre></td></tr></table></figure><h2 id="复制文件夹"><a href="#复制文件夹" class="headerlink" title="复制文件夹"></a>复制文件夹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scp命令后加 -r 参数即可</span></span><br><span class="line">scp -r</span><br><span class="line"></span><br><span class="line">scp [可选参数] file_source file_target</span><br><span class="line"><span class="comment"># 参数说明：</span></span><br><span class="line"><span class="comment"># -1： 强制scp命令使用协议ssh1</span></span><br><span class="line"><span class="comment"># -2： 强制scp命令使用协议ssh2</span></span><br><span class="line"><span class="comment"># -4： 强制scp命令只使用IPv4寻址</span></span><br><span class="line"><span class="comment"># -6： 强制scp命令只使用IPv6寻址</span></span><br><span class="line"><span class="comment"># -B： 使用批处理模式（传输过程中不询问传输口令或短语）</span></span><br><span class="line"><span class="comment"># -C： 允许压缩。（将-C标志传递给ssh，从而打开压缩功能）</span></span><br><span class="line"><span class="comment"># -p：保留原文件的修改时间，访问时间和访问权限。</span></span><br><span class="line"><span class="comment"># -q： 不显示传输进度条。</span></span><br><span class="line"><span class="comment"># -r： 递归复制整个目录。</span></span><br><span class="line"><span class="comment"># -v：详细方式显示输出。scp和ssh(1)会显示出整个过程的调试信息。这些信息用于调试连接，验证和配置问题。</span></span><br><span class="line"><span class="comment"># -c cipher： 以cipher将数据传输进行加密，这个选项将直接传递给ssh。</span></span><br><span class="line"><span class="comment"># -F ssh_config： 指定一个替代的ssh配置文件，此参数直接传递给ssh。</span></span><br><span class="line"><span class="comment"># -i identity_file： 从指定文件中读取传输时使用的密钥文件，此参数直接传递给ssh。</span></span><br><span class="line"><span class="comment"># -l limit： 限定用户所能使用的带宽，以Kbit/s为单位。</span></span><br><span class="line"><span class="comment"># -o ssh_option： 如果习惯于使用ssh_config(5)中的参数传递方式，</span></span><br><span class="line"><span class="comment"># -P port：注意是大写的P, port是指定数据传输用到的端口号</span></span><br><span class="line"><span class="comment"># -S program： 指定加密传输时所使用的程序。此程序必须能够理解ssh(1)的选项。</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>terminal</title>
      <link href="/ckbarvw1r0028yayddfkf91wh/"/>
      <url>/ckbarvw1r0028yayddfkf91wh/</url>
      
        <content type="html"><![CDATA[<p>Mac终端terminal自动补全之忽略大小写</p><a id="more"></a><h2 id="自动补全忽略大小写（terminal）"><a href="#自动补全忽略大小写（terminal）" class="headerlink" title="自动补全忽略大小写（terminal）"></a>自动补全忽略大小写（terminal）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端中输入以下命令：</span></span><br><span class="line">$ nano .inputrc</span><br><span class="line"><span class="comment"># 在里面粘贴一下语句后, Control+O 保存</span></span><br><span class="line"><span class="built_in">set</span> completion-ignore-case on</span><br><span class="line"><span class="built_in">set</span> show-all-if-ambiguous on</span><br><span class="line">TAB: menu-complete</span><br><span class="line"></span><br><span class="line"><span class="comment"># PS: 需重启终端生效</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ipv6</title>
      <link href="/ckbarvw1s002ayayd468jbz3m/"/>
      <url>/ckbarvw1s002ayayd468jbz3m/</url>
      
        <content type="html"><![CDATA[<p>Mac系统关闭ipv6</p><a id="more"></a><h2 id="Mac修改网络时遇到无法修改，需先关闭ipv6"><a href="#Mac修改网络时遇到无法修改，需先关闭ipv6" class="headerlink" title="Mac修改网络时遇到无法修改，需先关闭ipv6"></a>Mac修改网络时遇到无法修改，需先关闭ipv6</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># command</span></span><br><span class="line">networksetup -listallnetworkservices | sed 1d | xargs -I &#123;&#125; networksetup -setv6off &#123;&#125;</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Homebrew</title>
      <link href="/ckbarvw1q0025yaydh4m4daue/"/>
      <url>/ckbarvw1q0025yaydh4m4daue/</url>
      
        <content type="html"><![CDATA[<p>mac提供包管理器的安装和使用(类似Ubuntu的apt，Linux的yum、pkg)</p><a id="more"></a><h2 id="Homebrew安装"><a href="#Homebrew安装" class="headerlink" title="Homebrew安装"></a>Homebrew安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure><h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew list package</span><br><span class="line">brew install &lt;package_name&gt;</span><br><span class="line">brew uninstall &lt;package_name&gt;</span><br></pre></td></tr></table></figure><h2 id="其他软件"><a href="#其他软件" class="headerlink" title="其他软件"></a>其他软件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Cakebrew和LaunchRocket</span></span><br><span class="line">brew cask install cakebrew</span><br><span class="line">brew cask install launchrocket</span><br><span class="line"><span class="comment"># PS：注意 launchrocket 只能管理Homebrew安装的服务，不支持源码下载安装的服务</span></span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Finder</title>
      <link href="/ckbarvw1o001vyayd1e0k3qlq/"/>
      <url>/ckbarvw1o001vyayd1e0k3qlq/</url>
      
        <content type="html"><![CDATA[<p>Finder 显示与隐藏 隐藏文件(.文件)</p><a id="more"></a><h2 id="命令行永久改变显示方式"><a href="#命令行永久改变显示方式" class="headerlink" title="命令行永久改变显示方式"></a>命令行永久改变显示方式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示</span></span><br><span class="line">defaults write com.apple.finder AppleShowAllFiles -bool <span class="literal">true</span>; killall Finder</span><br><span class="line"><span class="comment"># 隐藏</span></span><br><span class="line">defaults write com.apple.finder AppleShowAllFiles -bool <span class="literal">false</span>; killall Finder</span><br><span class="line"><span class="comment"># PS: 输入完命令回车后，需重启Finder：左上角的苹果标志--&gt;强制退出--&gt;Finder--&gt;重新启动</span></span><br></pre></td></tr></table></figure><h2 id="临时显示-隐藏快捷键"><a href="#临时显示-隐藏快捷键" class="headerlink" title="临时显示/隐藏快捷键"></a>临时显示/隐藏快捷键</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> + <span class="built_in">shift</span> + .</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac开启任何来源</title>
      <link href="/ckbarvw1o001yyaydfxrge9yq/"/>
      <url>/ckbarvw1o001yyaydfxrge9yq/</url>
      
        <content type="html"><![CDATA[<p>Mac在macOS系统下，系统偏好设置中的“安全与隐私”默认已经去除了允许“任何来源”App的选项，如果不开启会直接影响到无法运行一些第三方应用。</p><a id="more"></a><h2 id="开启权限命令"><a href="#开启权限命令" class="headerlink" title="开启权限命令"></a>开启权限命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示</span></span><br><span class="line">sudo spctl --status --master-disable</span><br><span class="line"><span class="comment"># 隐藏</span></span><br><span class="line">sudo spctl --status --master-enable</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wongqingbin/Frieza/raw/master/image/spctl.png" alt="任何来源.png"></p><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bubble Sort</title>
      <link href="/ckbarvw1m001ryayd2tq6599d/"/>
      <url>/ckbarvw1m001ryayd2tq6599d/</url>
      
        <content type="html"><![CDATA[<p>经典面试题---进阶版冒泡排序</p><a id="more"></a><h2 id="常规版"><a href="#常规版" class="headerlink" title="常规版"></a>常规版</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="string">"""常规版"""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(data)-i<span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> data[j] &gt; data[j+<span class="number">1</span>]:</span><br><span class="line">                data[j], data[j + <span class="number">1</span>] = data[j + <span class="number">1</span>], data[j]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    data = [<span class="number">3</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>]</span><br><span class="line">    print(data)</span><br><span class="line">    print(foo(data))</span><br></pre></td></tr></table></figure><h2 id="进阶版"><a href="#进阶版" class="headerlink" title="进阶版"></a>进阶版</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    进阶版</span></span><br><span class="line"><span class="string">    最坏情况 时间复杂度 O(n**2)</span></span><br><span class="line"><span class="string">    最好情况 时间复杂度 O(n)</span></span><br><span class="line"><span class="string">    稳定排序法</span></span><br><span class="line"><span class="string">    空间复杂度最佳 只需要一个额外空间</span></span><br><span class="line"><span class="string">    适用于数据量小或有部分数据已经排过序的情况</span></span><br><span class="line"><span class="string">    :param data:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># i 倒序循环列表排序</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data)<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        flag = <span class="literal">False</span>  <span class="comment"># flag判断是否执行了交换操作</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i):  <span class="comment"># i 为倒序循环，所以j的最大值即是i 0～i</span></span><br><span class="line">            <span class="keyword">if</span> data[j] &gt; data[j + <span class="number">1</span>]:</span><br><span class="line">                data[j], data[j + <span class="number">1</span>] = data[j + <span class="number">1</span>], data[j]</span><br><span class="line">                flag = <span class="literal">True</span>  <span class="comment"># 执行过交换操作，把flag置为True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:  <span class="comment"># 执行完一次扫描后，判断是否执行过交换操作，如果没有交换过数据，就表示此时数组已完成排序，故直接跳出循环</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        print(<span class="string">'第&#123;0&#125;次排序: &#123;1&#125;'</span>.format(len(data)-i, data))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    data = [<span class="number">3</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>]</span><br><span class="line">    print(data)</span><br><span class="line">    print(bubble_sort(data))</span><br></pre></td></tr></table></figure><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> interviewer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>antdvp.vue-cli</title>
      <link href="/ckbarvw2u003wyayd09jnel42/"/>
      <url>/ckbarvw2u003wyayd09jnel42/</url>
      
        <content type="html"><![CDATA[<p>ant-design-vue-pro 使用脚手架 vue-cli 创建项目</p><a id="more"></a><h2 id="vue-create"><a href="#vue-create" class="headerlink" title="vue create "></a>vue create <my-project-name></my-project-name></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#npm install -g @vue/cli  vue --version  @vue/cli 4.3.1</span></span><br><span class="line">vue create &lt;my-project-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Vue CLI v4.3.1</span></span><br><span class="line"><span class="comment"># ? Please pick a preset: Manually select features</span></span><br><span class="line"><span class="comment"># ? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter</span></span><br><span class="line"><span class="comment"># ? Use history mode for router? (Requires proper server setup for index fallback in production) Yes</span></span><br><span class="line"><span class="comment"># ? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less</span></span><br><span class="line"><span class="comment"># ? Pick a linter / formatter config: Prettier</span></span><br><span class="line"><span class="comment"># ? Pick additional lint features: Lint on save</span></span><br><span class="line"><span class="comment"># ? Where do you prefer placing config for Babel, ESLint, etc.? In dedicated config files</span></span><br><span class="line"><span class="comment"># ? Save this as a preset for future projects? Yes</span></span><br><span class="line"><span class="comment"># ? Save preset as: a-d-v-p</span></span><br></pre></td></tr></table></figure><h2 id="Less、history"><a href="#Less、history" class="headerlink" title="Less、history"></a>Less、history</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Less: css加载器使用less，方便之后做主题颜色修改配置</span></span><br><span class="line"><span class="comment"># history: 最终路由中不带#号，漂亮的url路由</span></span><br><span class="line"><span class="comment"># In dedicated config files: 配置文件不堆积在package.json中；使用单独的配置文件vue.confi.js需手动新建</span></span><br></pre></td></tr></table></figure><h2 id="npm-run-serve"><a href="#npm-run-serve" class="headerlink" title="npm run serve"></a>npm run serve</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证第一步是否创建成功</span></span><br><span class="line"><span class="built_in">cd</span> &lt;my-project-name&gt;</span><br><span class="line">npm run serve</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步 安装插件ant-design-vue 和 moment</span></span><br><span class="line">npm i ant-design-vue moment</span><br></pre></td></tr></table></figure><h2 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># webpack配置之less-load引入</span></span><br><span class="line">mkdir vue.config.js</span><br><span class="line"><span class="comment"># 修改vue.config.js文件，添加css内容</span></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // less-load</span><br><span class="line">  css: &#123;</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      less: &#123;</span><br><span class="line">        // 这里的选项会传递给 less-loader</span><br><span class="line">        javascriptEnabled: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 组件和样式按需加载，优化减小前端加载流量</span></span><br><span class="line"><span class="comment"># babel.config.js 文件配置</span></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [<span class="string">"@vue/cli-plugin-babel/preset"</span>],</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"import"</span>,</span><br><span class="line">      &#123; libraryName: <span class="string">"ant-design-vue"</span>, libraryDirectory: <span class="string">"es"</span>, style: <span class="literal">true</span> &#125;</span><br><span class="line">    ] // `style: <span class="literal">true</span>` 会加载 less 文件</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment"># 安装插件 babel-plugin-import</span></span><br><span class="line">npm i --save-dev babel-plugin-import</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wongqingbin/Frieza/raw/master/image/advp.png" alt="advp.png"></p><p><br><br><span class="btn large center"><a href="https://github.com/wongqingbin/blog/issues" target="_blank" rel="external nofollow noopener noreferrer" title="向博主反馈问题"><i class="fas fa-paper-plane"></i>向博主反馈问题</a></span></p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/ckbarvvzk0001yayd5fpg370n/"/>
      <url>/ckbarvvzk0001yayd5fpg370n/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external nofollow noopener noreferrer">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external nofollow noopener noreferrer">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external nofollow noopener noreferrer">GitHub</a>.</p><a id="more"></a><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external nofollow noopener noreferrer">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external nofollow noopener noreferrer">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external nofollow noopener noreferrer">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="external nofollow noopener noreferrer">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
